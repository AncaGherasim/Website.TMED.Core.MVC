@model MVC_TMED.Models.ViewModels.HotelsMapViewModel
@using MVC_TMED.Infrastructure;
@using Microsoft.Extensions.Options;
@using System.Text.RegularExpressions;
@inject IOptionsMonitor<AppSettings> _appsettings


@{
    <environment include="Development">
        <link rel="stylesheet" href="~/css/hotelist/dt.style.hotelsoncity.css" />
    </environment>
    <environment exclude="Development">
        <link rel="stylesheet" href="~/css/hotelist/dt.style.hotelsoncity.min.css" />
    </environment>
}

@{
    <script>var SiteName = '@_appsettings.CurrentValue.ApplicationSettings.SiteName' </script>
    <script>var plcID = '@Model.hotelInfo.FirstOrDefault().plcID' </script>
}

<input type="hidden" id="placeNA" value="@Model.hotelInfo.FirstOrDefault().plcNA" />
<input type="hidden" id="placeID" value="@Model.hotelInfo.FirstOrDefault().plcID" />
<input type="hidden" id="countryNA" value="@Model.hotelInfo.FirstOrDefault().couNA" />
<input type="hidden" id="countryID" value="@Model.hotelInfo.FirstOrDefault().couID" />

<div class="main-content">
    <div class="main-container" style="padding-bottom: 15px;">
        <ul class="breadcrumbs">
            <li><a href="/">Home</a></li>
            <li class="breadcrumbs__arrow">›</li>
            <li><a href=@String.Format("/europe/{0}/vacations", @Model.hotelInfo.First().couNA.Replace(" ", "_"))>@Model.hotelInfo.First().couNA</a></li>
            <li class="breadcrumbs__arrow">›</li>
            <li><a href=@String.Format("/europe/{0}/vacations", @Model.hotelInfo.First().plcNA.Replace(" ", "_"))>@Model.hotelInfo.First().plcNA</a></li>
            <li class="breadcrumbs__arrow">›</li>
            <li><a href=@String.Format("/europe/{0}/{1}/hotels", @Model.hotelInfo.First().couNA.Replace(" ", "_"), @Model.hotelInfo.First().plcNA.Replace(" ", "_"))>@Model.hotelInfo.First().plcNA Hotels</a></li>
        </ul>
        <h1 class="main-title">Hotels in @Model.plcNA Map</h1>
            <div class="mobile-nav__buttons" style="justify-content: center;">
                <button id="modalFilter" type="button"><div><span></span><span></span><span></span></div>sort & filter</button>
            </div>
    <div class="main-content__wrapper">
        <!-- Left Column W -->
        <div class="main-content__left">
            <div class="hotels__filter">
                <h3 class="hotels__filter-title" style="margin-top: 0;">Filter hotels by:</h3>
                <div class="hotels__filter-zone">
                    <h4 class="hotels__filter--subtitle">Neigborhood/City Zone:</h4>
                    <div>
                        <select id="selZone">
                            <option value="0">Show All</option>
                                @foreach (var zo in @Model.listCityZones)
                                {
                                    string _cityzone = "";
                                    @if (zo.cityzone.Length >= 4)
                                    {
                                        _cityzone = zo.cityzone.Substring(4, zo.cityzone.Length - 4);
                                    }
                                    <option value="@zo.giph_tnzoneid">
                                        @_cityzone
                                    </option>
                                }
                            </select>
                    </div>
                </div>
                <div class="hotels__filter-rating">
                    <h4 class="hotels__filter--subtitle">Rating:</h4>
                    <div>
                            @foreach (var grp in Model.listRatings.OrderByDescending(x => x.giph_tntournetrating))
                            {
                                string strs = grp.giph_tntournetrating;
                                string imgSrc = "";
                            string hrate = "hotels";
                            string imgAlg = "align='absmiddle'";
                            string hotRat = "";
                    
                            switch (true)
                            {
                                case bool _ when Regex.IsMatch(strs, @"Stars|Lodge|Cruise"):
                                    imgSrc = "Stars_" + strs.Replace(" ", "_");
                                    if (imgSrc.Contains("+"))
                                    {
                                        imgSrc = imgSrc.Replace("+", "_Plus");
                                    }
                                    hotRat = strs;
                                    break;
                                default:
                                    imgSrc = strs.Replace(" ", "_").ToLower();
                                    break;
                            }
                    
                                <div class="dvChecks">
                                    <input type="checkbox" class="css-checkbox rat" id=@String.Format("chkStar{0}", grp.giph_tntournetrating.Replace(" ", "_").Replace("+", "plus")) value="@grp.giph_tntournetrating.Replace(" ", "_").Replace("+", "plus")" checked="checked" />
                                    <label for=@String.Format("chkStar{0}", grp.giph_tntournetrating.Replace(" ", "_").Replace("+", "plus")) name="checkbox65_lbl" class="css-label rat">
                                        <img src=@String.Format("https://pictures.tripmasters.com/siteassets/d/{0}.gif", imgSrc) @imgAlg />
                                        @hotRat

                                    </label>
                                    <a href="/" class="aOnly" id=@String.Format("a|chkStar{0}", grp.giph_tntournetrating.Replace(" ", "_").Replace("+", "plus"))>only</a>
                                </div>
                            }
                    </div>
                </div>
                <div class="hotels__filter-favorite">
                    <h4 class="hotels__filter--subtitle">Favorite</h4>
                    <div class="dvChecks">
                        <input type="checkbox" class="css-checkbox fav" id="favorite" value="1" />
                        <label for="favorite" name="checkbox65_lbl" class="css-label rat"> Show only <img src="https://pictures.tripmasters.com/siteassets/d/favorite.gif" align="absmiddle" /></label>
                        <a href="/" class="aOnly" id="a|favorite">only</a>
                    </div>
                </div>
                <div class="hotels__filter-score">
                    <h4 class="hotels__filter--subtitle">Review Score</h4>
                    <div class="dvReview">
                        @{
                            string[] reviews = Model.strReview.ToString().Split("|");
                            Int32 notC = 0;
                            string reviewNA = "";
                            string grpScore = "";
                            string idScore = "";
                            foreach (var rev in reviews)
                            {
                                switch (rev)
                                {
                                    case "Excellent":
                                        idScore = "4_5";
                                        grpScore = "4.5+";
                                        reviewNA = "Excellent 4.5+";
                                        break;
                                    case "Very":
                                        idScore = "4";
                                        grpScore = "4+";
                                        reviewNA = "Very Good 4+";
                                        break;
                                    case "Good":
                                        idScore = "3_5";
                                        grpScore = "3.5+";
                                        reviewNA = "Good 3.5+";
                                        break;
                                }
                                if (reviewNA != "none")
                                {
                                                                    <div class="dvChecks">
                                                                        <input type="checkbox" class="css-checkbox rev" id=@String.Format("chkRevw{0}", idScore) value="@idScore" checked="checked" />
                                                                        <label for=@String.Format("chkRevw{0}", idScore) name="checkbox65_lbl" class="css-label"> @reviewNA &nbsp; </label>
                                                                        <a href="/" class="aOnly" id=@String.Format("a|chkRevw{0}", idScore)>only</a>
                                                                    </div>
                                }
                            }
                        }
                    </div>
                </div>
                <div class="hotels__filter-favorite">
                    <h4 class="hotels__filter--subtitle" style="display: flex;grid-gap: 10px;align-items: center;">Point of interest <img src="https://pictures.tripmasters.com/siteassets/d/sightorange.gif" align="absmiddle" /></h4>
                    <div id="dvPoiList"></div>
                </div>
                <div class="hotels__reset">
                    <button id="resetButton" type="button">Reset Filters</button>
                    <button id="applyButton" type="button">Apply</button>
                </div>
            </div>         
        </div>

        <!-- Righ Column W -->
        <div class="main-content__right">
            <h3 class="hotels__big-map-title">Locate on map</h3>
            <div id="dvPageMap" class="hotels__big-map">&nbsp;</div>
        </div>
    </div>
    </div>
    @*Modal*@
    <div id="modal" class="backdrop is-hidden">
        <div class="modal__wrapper">
            <button class="modal__close" type="button" aria-label="Close modal">✖</button>
            <div class="modal__container">
            </div>
        </div>
    </div>
</div>

@section Scripts
    {

    <environment include="Development">
        <script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAd8S1lOSNhEy2FUzkGT34S1KCvadNLkz8"></script>
        <script src="~/js/hotelsmap/dt.java.poi-mapgoogle.js" asp-append-version="true"></script>
        <script src="~/js/hotelsmap/dt.java.poi-labelmarke.min.js" asp-append-version="true"></script>
        <script src="~/js/hotelsmap/jquery.nicescroll.js" asp-append-version="true"></script>
    </environment>
    <environment exclude="Development">
        <script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAd8S1lOSNhEy2FUzkGT34S1KCvadNLkz8"></script>
        <script src="~/js/hotelsmap/dt.java.poi-labelmarke.min.js" asp-append-version="true"></script>
        <script src="~/js/hotelsmap/dt.java.poi-mapgoogle.min.js" asp-append-version="true"></script>
        <script src="~/js/hotelsmap/jquery.nicescroll.min.js" asp-append-version="true"></script>
    </environment>
}

