function deleteFilterItem(n){filterResults=filterResults.filter(function(t){return t.id!==n})}function chooseType(n){const i=$("#"+n);i.toggleClass("selected");i.addClass("disabled");const u=n.replace("false",""),t=$('input[type="checkbox"][id="'+u+'"]');if(t.is(":checked"))t.prop("checked",!1),deleteFilterItem(n);else{t.prop("checked",!0);const i=t.val();getAmountActivities(i);filterResults.push({name:$("#"+n+" > span:nth-child(1)").text(),id:n})}typeFilter="";let r=0;$('input[type="checkbox"][id^="dotType"]:checked').each(function(){typeFilter+=$(this).val()+"T";r++});r===0&&(typeFilter=$("#typeFilter").val());IsMobileDevice()==!0?($(mob.element).html(""),OpenPage(mob.element,0,total)):($(desk.element).html(""),OpenPage(desk.element,0,total));setTimeout(()=>i.removeClass("disabled"),1e3)}function chooseFavorite(){$("#falseshowFav").hasClass("falsechecked_1")?($("#falseshowFav").removeClass("falsechecked_1"),$("#showFav").prop("checked",!1),deleteFilterItem("falseshowFav"),total=IsMobileDevice()==!0?mob.numOfItems*mob.page:desk.numOfItems*desk.page):($("#falseshowFav").addClass("falsechecked_1"),$("#showFav").prop("checked",!0),filterResults.push({name:'Show only <b style="color: #090;">Favorites✓<\/b>',id:"falseshowFav"}));IsMobileDevice()==!0?($(mob.element).html(""),OpenPage(mob.element,startIndex,total)):($(desk.element).html(""),OpenPage(desk.element,startIndex,total))}function getAmountActivities(n){var i=$("#SSIds").val(),t={};t.url=SiteName+"/Api/CitySSData";t.type="POST";t.contentType="application/json; charset=utf-8";t.data='{"SSFilter":"'+n+'T|0||1", "Ids":"'+i+'"}';t.dataType="text";t.success=function(t){var i=t.substr(1,t.length-2).split("@");const r=i[1];$("#falsedotType"+n+" > span:nth-child(2)").text("("+r+")")};t.error=function(n){console.error(n.responseText)};$.ajax(t)}function resetFilter(){$(".filter-result").addClass("is-hidden");filterResults=[];$('label[id*="sortBy"]').removeClass("active");$("#sortBy1").addClass("active");$('input[type="radio"][id="orderAll"]').prop("checked",!0);$("#tourName").val("");$('input[type="checkbox"][id="showFav"]').prop("checked",!1);$("#falseshowFav").removeClass("falsechecked_1");$('li[id^="falsedotType"]').removeClass();$('input[type="checkbox"][id^="dotType"]').prop("checked",!1);typeFilter=$("#typeFilter").val();ssLoaded=0;IsMobileDevice()==!0?($(mob.element).html(""),OpenPage(mob.element,startIndex,mob.numOfItems)):($(desk.element).html(""),OpenPage(desk.element,startIndex,desk.numOfItems))}function submitInputName(){var n=$("#tourName").val();if(n==""){messg="<ol><li>Please insert an activity name!<\/li><\/ol><span><\/span>";popError("tourName",messg);return}filterResults.push({name:"Tours name contains: <b>"+n+"<\/b>",id:"tourName"});$(".filter-result").removeClass("is-hidden");IsMobileDevice==!0?(startIndex=0,endIndex=total,OpenPage(mob.element,startIndex,endIndex)):(startIndex=0,endIndex=total,$(desk.element).html(""),OpenPage(desk.element,startIndex,endIndex))}function setCheckboxOnly(n){n=="TypeFavorite"?$("#falseshowFav").trigger("click"):($('a[id^="falsedot"]').removeClass().addClass("falsecheck_1"),$('input[id^="dot"]').prop("checked",!1),$("#falsedot"+n).addClass("falsechecked_1"),$("#dot"+n).prop("checked",!0),GetCitySSData())}function buildFilterResults(){const n=filterResults.map(function({name:t,id:n}){return`<li>
                    <span>${t}</span>
                    <button type="button" onclick="closeFilterResultItem('${n}')" aria-label="Close">✖</button>
                </li>`});$("#filterResultsList").html(n)}function closeFilterResultItem(n){switch(n){case"tourName":deleteFilterItem(n);$("#"+n).val("");IsMobileDevice()==!0?($(mob.element).html(""),OpenPage(mob.element,0,mob.numOfItems)):($(desk.element).html(""),OpenPage(desk.element,0,desk.numOfItems));break;case"falseshowFav":deleteFilterItem(n);$("#"+n).removeClass("falsechecked_1");$("#showFav").prop("checked",!1);IsMobileDevice()==!0?($(mob.element).html(""),OpenPage(mob.element,0,mob.numOfItems)):($(desk.element).html(""),OpenPage(desk.element,0,desk.numOfItems));break;default:chooseType(n)}}function BuildFilterExpression(){var n="",t,i;return n=$("#showFav").is(":checked")?"1":"0",t=$("#tourName").val(),i=$('input[name="orderValue"]:checked').val(),typeFilter==""&&(typeFilter="999999T"),typeFilter+"|"+n+"|"+t+"|"+i}function OpenPage(n,t,i){var u,r;$("#showMoreActivities").html('<img src="https://pictures.tripmasters.com/siteassets/d/ajax-loader.gif" width="18" height="15" />');$("#showMoreActivitiesMob").html('<img src="https://pictures.tripmasters.com/siteassets/d/ajax-loader.gif" width="18" height="15" />');filterResults.length?(buildFilterResults(),$(".filter-result").removeClass("is-hidden")):$(".filter-result").addClass("is-hidden");var f=BuildFilterExpression(),o=f.split("|"),e=$("#SSIds").val();if(e!=""){u=e.split("I");total=u.length;$(".spanTotalSS").html(total);const o=u.slice(t,i).join(",");r={};r.url=SiteName+"/Api/CityActivities";r.type="POST";r.contentType="application/json; charset=utf-8";r.data='{"SSFilter":"'+f+'", "Ids":"'+o+'"}';r.dataType="json";r.success=function(t){let i="";ssLoaded+=t.length;$("#totalFilterResults").html(t.length+" total");jQuery.each(t,function(){i+=`<li>
                                <img class="lazyload" src="https://pictures.tripmasters.com/siteassets/d/spacer.gif" data-src="https://pictures.tripmasters.com${this.imG_Path_URL.toLowerCase()}" onerror="this.src='https://pictures.tripmasters.com/siteassets/d/no-image.jpg'" alt='${this.name}'/>
                                <div class="activities__wrapper">
                                    <h3>${this.name}</h3>
                                    <div>
                                        <div class="activities__info">
                                            <span class="activities__favorites">${this.pdL_SequenceNo>49&&this.pdL_SequenceNo<60?"Favorites &#10003;":"&nbsp;"}</span>
                                            <p>Score: ${this.rating>0&&this.reviews>0?"<b>"+this.rating+"/5<\/b> ("+this.reviews+"reviews)":"<b>Not rated yet<\/b>("+this.reviews+"reviews)"}</p>
                                            <p>Type: ${this.scD_CodeTitle}</p>
                                            <p>Duration: ${this.ssDuration} </p>
                                        </div>
                                        <div class="activities__button"><button class="activities__details" onclick="openTourDetails(${this.id})">tour details <span>›</span></button></div>
                                    </div>
                                </div>
                                <div class="activities__modal-info is-hidden Info${this.id}">
                                    <div>
                                        <button class="activities__top-button" onclick="closeTourDetails(${this.id})"><span>✖</span><span>close</span></button>
                                        <p>${this.name}<span class="activities__favorites">${this.pdL_SequenceNo>49&&this.pdL_SequenceNo<60?"Favorites &#10003;":""}</span></p>
                                        <div class="activities__flex">
                                            <img class="lazyload" src="https://pictures.tripmasters.com/siteassets/d/spacer.gif" data-src="https://pictures.tripmasters.com${this.imG_Path_URL.toLowerCase()}"  onerror="this.src='https://pictures.tripmasters.com/siteassets/d/no-image.jpg'" alt='${this.name}'/>
                                            <ul>
                                                <li><div>Score:</div><div>${this.rating>0&&this.reviews>0?"<b>"+this.rating+"<\/b><span> out of 5<\/span>":"<b>Not rated yet<\/b>"}</div></li>
                                                <li><div>Reviews:</div><div>${this.reviews}</div></li>
                                                <li><div>Type:</div><div>${this.scD_CodeTitle}</div></li>
                                                <li><div>Duration:</div><div>${this.ssDuration} </div></li>
                                            </ul>
                                        </div>
                                        ${this.pdL_Description}
                                        <button class="activities__bottom-button" onclick="closeTourDetails(${this.id})"><span>✖</span>close</button>
                                    </div>
                                </div>
                            </li>`});$(n).append(i);$("#dvWait").html("");$("#dvWait").hide();$("#showMoreActivities").html("show more");$("#showMoreActivitiesMob").html("show more");$("#showMoreActivitiesMob").show();$("#showMoreActivities").show();total<=mob.page*mob.numOfItems&&$("#showMoreActivitiesMob").hide();total<=desk.page*desk.numOfItems&&$("#showMoreActivities").hide()};r.error=function(t){$(n).html(t.responseText);$("#dvWait").html("");$("#dvWait").hide()};$.ajax(r)}else $(n).html('<div class="activities__no-result">0 activities found. Please try other combination.<\/div>'),$("#dvWait").html(""),$("#dvWait").hide()}function openTourDetails(n){$("body").addClass("modal-open");$(".Info"+n).removeClass("is-hidden");let t=document.querySelectorAll(".Info"+n);t.forEach(t=>{t.addEventListener("click",t=>handleButtonClick(t,n))})}function closeTourDetails(n){$("body").removeClass("modal-open");$(".Info"+n).addClass("is-hidden");let t=document.querySelectorAll(".Info"+n);t.forEach(t=>{t.removeEventListener("click",t=>handleButtonClick(t,n))})}function handleButtonClick(n,t){n.target===n.currentTarget&&closeTourDetails(t)}function showMoreActivities(){desk.page++;const n=desk.numOfItems*(desk.page-1),t=desk.numOfItems*desk.page;OpenPage(desk.element,n,t)}function showMoreActivitiesMob(){mob.page++;const n=mob.numOfItems*(mob.page-1),t=mob.numOfItems*mob.page;OpenPage(mob.element,n,t)}function openModalMap(){openModal();typeModal="map";$(".modal__container").html("");$(".filter__map-wrapper").appendTo(".modal__container")}function openModalFilter(){openModal();typeModal="sort";$(".modal__container").html("");$(".desk-nav__sort-wrapper").appendTo(".modal__container");$(".filter__wrapper").appendTo(".modal__container")}function openModal(){$(".modal__container").html('<div style="padding:15px 15px;text-align:center;"><img src="https://pictures.tripmasters.com/siteassets/d/wait.gif"><\/div>');$("#modal").removeClass("is-hidden");$("body").addClass("modal-open")}function closeModal(){$("#modal").addClass("is-hidden");$("body").removeClass("modal-open");switch(typeModal){case"map":$(".filter__map-wrapper").appendTo(".filter__map");break;case"sort":$(".desk-nav__sort-wrapper").appendTo(".desk-nav__sort");$(".filter__wrapper").appendTo(".filter");break;case"default":$(".modal__container").html("")}}function getMapPoiData(n){var t={Id:n};$.ajax({type:"POST",url:SiteName+"/Api/Hotels/POIHotels/",contentType:"application/json; charset=UTF-8",data:JSON.stringify(t),success:function(n){objPOI=n;ctyLatLong=getDistance(n);buildThumbMap()},error:function(n){$("#dvGoogleMap").html(n.responseText)}})}function getDistance(n){var r,u;ctylocLat=0;ctylocLong=0;var t=[],i=[],f=0;return jQuery.each(n,function(){t.push(Number(this.poI_Latitude));i.push(Number(this.poI_Longitude));f++}),r=(Math.max.apply(Math,t)-Math.min.apply(Math,t))/2+Math.min.apply(Math,t),u=(Math.max.apply(Math,i)-Math.min.apply(Math,i))/2+Math.min.apply(Math,i),delete distLats,distLats=getDistanceFromLatLonInKm(Math.max.apply(Math,t),Math.max.apply(Math,i),Math.min.apply(Math,t),Math.min.apply(Math,i)),delete ctyLatLong,ctyLatLong=Number(r)+"|"+Number(u)}function buildThumbMap(){var n=ctyLatLong.split("|"),t=n[0],i=n[1],r='<iframe style="border:0;position:relative;margin-left:-40px;margin-top:-40px;"src = "https://www.google.com/maps/embed/v1/view?key=AIzaSyAd8S1lOSNhEy2FUzkGT34S1KCvadNLkz8&center='+t+","+i+'&zoom=10" width="300" height="300" frameborder="0"><\/iframe>';$("#dvMapCanvas").html(r)}function getDistanceFromLatLonInKm(n,t,i,r){var u=deg2rad(i-n),f=deg2rad(r-t),e=Math.sin(u/2)*Math.sin(u/2)+Math.cos(deg2rad(n))*Math.cos(deg2rad(i))*Math.sin(f/2)*Math.sin(f/2),o=2*Math.atan2(Math.sqrt(e),Math.sqrt(1-e));return 6371*o}function deg2rad(n){return n*(Math.PI/180)}function buildMapPoi(){var i,r;map=null;var t=ctyLatLong.split("|"),u=t[0],f=t[1],e=new google.maps.LatLng(u,f),n=10;switch(!0){case distLats<50:n=11;break;case distLats>50&&distLats<150:n=10;break;case distLats>150:n=9}i={zoom:n,center:e,mapTypeControl:!0,mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.DROPDOWN_MENU},panControl:!0,zoomControl:!0,mapTypeId:google.maps.MapTypeId.ROADMAP};map=new google.maps.Map(document.getElementById("dvGoogleMap"),i);r=0;jQuery.each(objPOI,function(){var i,f,u;r++;var e=this.poI_Latitude,o=this.poI_Longitude,s=new google.maps.Point(4,25),t=new google.maps.Marker({icon:"https://pictures.tripmasters.com/siteassets/d/MapMarker_Ball__Orange_40.gif",position:new google.maps.LatLng(e,o),map:map,draggable:!1,raiseOnDrag:!0,labelAnchor:s,labelInBackground:!1,labelStyle:{opacity:1},title:this.POI_Title,zIndex:8998}),n='<div class="dvBublleStyle">';this.POI_PictureURL!="none"&&(n=n+'<img src="'+this.poI_PictureURL+'" align="left"/>');n=n+"<div>"+this.poI_Title+"<\/div>";this.POI_Description!="none"&&(n=n+this.poI_Description);n=n+"<\/div>";i=new google.maps.InfoWindow({content:n,size:new google.maps.Size(40,40)});google.maps.event.addListener(t,"click",function(){closePoiInfoW(map,t,i)});infoPOIWindows.push(i);f=this.poI_Title;u=new google.maps.InfoWindow({content:f,size:new google.maps.Size(20,20)});google.maps.event.addListener(t,"mouseover",function(){u.open(map,t)});google.maps.event.addListener(t,"mouseout",function(){u.close(map,t)})})}function closePoiInfoW(n,t,i){for(var r=0;r<infoPOIWindows.length;r++)infoPOIWindows[r].close();i.open(n,t)}function getHotClosePoiData(n,t,i){for(var f,e,u,r=0;r<infoPOIWindows.length;r++)infoPOIWindows[r].getMap()&&(infoPOIWindows[r].setContent('<div style="height:auto; padding:10px 10px;" ><img src="https://pictures.tripmasters.com/siteassets/d/ajax-loader.gif"><br/>... loading hotels<\/div>'),u=infoPOIWindows[r]);for(r=0;r<markerHotels.length;r++)markerHotels[r].setMap(null);f=new google.maps.LatLng(t,i);e=15;map.setZoom(e);map.panTo(f);$.ajax({type:"POST",url:"/europe/WS_Library.asmx/getHotelClosePOI",contentType:"application/json; charset=utf-8",dataType:"json",data:'{plcID:"'+n+'", hLat:"'+t+'", hLong:"'+i+'"}',success:function(n){objHOT=eval("("+n.d+")");objHOT.length>0?(u.close(),buildHotelPoi(n)):u.setContent('<div style="height:auto; padding:10px 10px;" >No closer hotels found<\/div>')},error:function(n){alert(n.responseText)}})}function buildHotelPoi(){var n=0;jQuery.each(objHOT,function(){var u;n++;var f=this.PTY_Latitude,e=this.PTY_Longitude,r=this.SCD_CodeTitle.match(isNumber),o="hotel_"+r+"stars_GR.png",s=new google.maps.Point(-13,39),i=new google.maps.Marker({position:new google.maps.LatLng(f,e),map:map,draggable:!1,raiseOnDrag:!0,icon:"https://pictures.tripmasters.com/siteassets/d"+o,labelContent:'<div class="bubbleH">'+this.PDL_Title+"<\/div>",labelAnchor:s,labelInBackground:!1,labelStyle:{opacity:.75},title:this.PDL_Title,zIndex:8998}),t='<div class="dvHotBubble">';this.IMG_Path_URL!="none"&&(t=t+'<div class="dvimgHot"><img src="https://pictures.tripmasters.com'+this.IMG_Path_URL.toLowerCase()+'"/><\/div>');t=t+'<div class="dvaddHot"><span>'+this.PDL_Title+'<\/span><br/><img src="https://pictures.tripmasters.com/siteassets/d/Stars_'+r+'_Stars.gif"/><p>'+this.PTY_Address+"<\/p><\/div>";this.POI_Description!="none"&&(t=t+'<div class="dvdescHot">'+this.PTY_Description+"<\/div>");t=t+"<\/div>";u=new google.maps.InfoWindow({content:t,size:new google.maps.Size(40,40)});google.maps.event.addListener(i,"click",function(){u.open(map,i)});markerHotels.push(i)})}function windowCMS(n,t,i){var r,u,f,e=navigator.userAgent,s=document.domain,o="/cms/"+n+"?cms&wh=0&wf=0";r=screen.width?(screen.width-t)/2:0;u=screen.height?(screen.height-i)/2:0;f=e.indexOf("Firefox")>=0?"height="+i+",width="+t+",top="+u+",left="+r+",scrollbars=yes,resizable,toolbar=yes":e.indexOf("Chrome")>=0?"height="+i+",width="+t+",top="+u+",left="+r+"":"height="+i+",width="+t+",top="+u+",left="+r+",scrollbars=yes,resizable,location=yes";window.open(o,"CMS_Window",f)}function popError(n,t){var i=$("#"+n+"").offset();$("#divError").html(t);$("#divError").show();$("#divError").offset({left:i.left-10,top:i.top-50});setTimeout("$('#divError').hide()",2e3)}function closeClick(n){$("#divError").hide();IsMobileDevice()&&$("#"+n+"").val("");$("#"+n+"").select()}var ctyID,infoPOIWindows=[],objPOI,map,ctylocLat,ctylocLong,objHotPOI;let isFirstLoad=!0,total=0,typeFilter="",filterResults=[],typeModal="default",startIndex=0,ssLoaded=0;const listOfActivities={mob:{element:"#dvRespMob",numOfItems:12,page:1},desk:{element:"#dvResp",numOfItems:24,page:1}},{mob,desk}=listOfActivities;$(document).ready(function(){typeFilter=$("#typeFilter").val();$('li[id^="falsedotType"]').click(function(){chooseType(this.id)});$("#ResetFilter, #clearFilters").click(function(){resetFilter()});$("#falseshowFav").click(function(){chooseFavorite()});$('label[id*="sortBy"]').click(function(){$('label[id*="sortBy"]').removeClass("active");$("#"+this.id).addClass("active")});$('input[name="orderValue"]').click(function(){let n=0;const i=BuildFilterExpression(),t=i.split("|");(t[1]==="1"||t[2]!="")&&(n=total);n=ssLoaded/mob.page==12||ssLoaded/desk.page==24?IsMobileDevice()==!0?mob.numOfItems*mob.page:desk.numOfItems*desk.page:total;IsMobileDevice()==!0?($(mob.element).html(""),OpenPage(mob.element,0,n)):($(desk.element).html(""),OpenPage(desk.element,0,n))});ctyID=$("#cityId").val();$("#dvPoiLink, #modalMap").click(function(){$("#bigMap").removeClass("is-hidden");buildMapPoi()});$("#bigMapClose").click(function(){$("#bigMap").addClass("is-hidden")});$('input:text[id^="tourName"]').click(function(){var n=navigator.userAgent.match(/iPad/i)!=null;n===!0&&(this.value="");this.focus();this.select()});$("#tourName").keypress(function(n){n.keyCode==13&&submitInputName()});$("#submitInputName").click(function(){submitInputName()});$("#showMoreActivities").click(function(){showMoreActivities()});$("#showMoreActivitiesMob").click(function(){showMoreActivitiesMob()});$("#modalFilter").click(function(){openModalFilter()});$(".modal__close, #applyButton").click(function(){closeModal()});IsMobileDevice()==!0?OpenPage(mob.element,startIndex,mob.numOfItems):OpenPage(desk.element,startIndex,desk.numOfItems);getMapPoiData(ctyID)});ctylocLat=0;ctylocLong=0;