function buildPackImg(){var n,t="",i=$("#idPack").val();$.ajax({type:"Get",url:SiteName+"/Api/Packages/PicsForPacks/"+i,contentType:"application/json; charset=utf-8",dataType:"json",success:function(i){var r=$.grep(i,function(n){return n.pxI_Sequence==0});n=r[0].imG_500Path_URL!=="none"?r[0].imG_500Path_URL:r[0].imG_Path_URL;$(".topImg").attr("src","https://pictures.tripmasters.com"+n);$.each(i,function(n,i){var r,u="";n==0?u="active":"";r=i.imG_500Path_URL!=="none"?i.imG_500Path_URL:i.imG_Path_URL;t=t+'<div class="carousel-item '+u+'"><img class="img-fluid" src="https://pictures.tripmasters.com'+r+'" /><\/div>'});$(".carousel-inner").html(t)},error:function(n){$("#packPics").html(n.responseText)}})}function getDeparture(){$.ajax({type:"Get",url:SiteName+"/Api/Packages/depCity",contentType:"application/json; charset=utf-8",dataType:"json",success:function(n){var t=n;depCities=$.map(t,function(n){var t=n.plC_Code?n.plC_Code.trim():"";if(t.toLowerCase()!=="none")return{label:n.plC_Title+" - "+n.plC_Code,value:n.plC_Title,id:n.plcid}});doitDep()},error:function(n){alert(n.responseText+" = Error")}})}function doitDep(){$("#iDepCityTxt").autocomplete({autoFocus:!0,source:depCities,minLength:3,response:function(n,t){if(t.content.length===0)return alert("No valid airport found"),!1},select:function(n,t){return $("#iDepCityTxt").val(t.item.value).blur(),$("#iDepCity").val(t.item.id),$("#iRetCity").val(t.item.id),!1}}).click(function(){$("#iDepCityTxt").select().removeClass("errorClass")}).data("ui-autocomplete")._renderItem=function(n,t){var i=$("<span><\/span>").text(t.label);return highlightText(this.term,i),$("<li><\/li>").append(i).appendTo(n)};$(".inpChild").autocomplete({autoFocus:!0,source:childAge,minLength:0,select:function(n,t){return $(this).val(t.item.value).blur(),!1},response:function(n,t){t.content.length===0&&(errorAlert(this.id,"No valid age"),$(this).blur())}}).click(function(){$(this).removeClass("errorClass");$(this).val("");$(this).attr("readonly",!1)}).focus(function(){$(this).keydown();$(this).attr("readonly",!0)}).blur(function(){($(this).val()==="0"||$(this).val()==="1")&&errorAlert(this.id,"No valid age")})}function highlightText(n,t){for(var f=$.trim(n).toLowerCase(),i=t.get(0).firstChild,e,u,r;(e=i.data.toLowerCase().indexOf(f))>=0;)u=i.splitText(e),i=u.splitText(f.length),r=document.createElement("span"),r.className="highlight",i.parentNode.insertBefore(r,i),r.appendChild(u)}function dateByDest(){var h=$("#fxNetDates").val(),t,f,n,s,u;if(h!=0)return!1;if(t=$("#blockDates").val(),t==0)n=new Date(myDate.getTime()+6048e5),f='"'+today.getFullYear()+":"+Number(today.getFullYear()+1)+'"',$("#InDate1").datepicker({defaultDate:n,yearRange:f,changeMonth:!1,changeYear:!1,numberOfMonths:1,showButtonPanel:!0,format:"yyyy-mm-dd",hideIfNoPrevNext:!0,prevText:"",nextText:"",minDate:n,showOtherMonths:!1,maxDate:"+365d"}).click(function(){$(this).attr("style","").removeClass("errorClass")});else{t=t.replace("B-","");t=t.trim().split("-");var e=t[0].split("*"),c=t[1].split("*"),y=new Date;for(i=0;i<=e.length-1;i++)for(var l=e[i],a=c[i],r=stringToDate(""+a+"","mm/dd/yyyy","/"),v=stringToDate(""+l+"","mm/dd/yyyy","/"),o;v<=r;)o=r.getDate(),between.push(jQuery.datepicker.formatDate("yy-mm-dd",r)),r=new Date(r.setDate(--o));if(n="",n=new Date(myDate.getTime()+6048e5),s=new Date(myDate.getTime()+7776e6),u=jQuery.datepicker.formatDate("yy-mm-dd",n),between.indexOf(u)!=-1){while(between.indexOf(u)!=-1)n.setDate(n.getDate()+1),u=jQuery.datepicker.formatDate("yy-mm-dd",n);s<=n&&$("#InDate1").val(jQuery.datepicker.formatDate("mm/dd/yy",n))}$("#InDate1").datepicker("destroy");$("#InDate1").datepicker({orientation:"top",defaultDate:n,changeMonth:!1,changeYear:!1,numberOfMonths:1,showButtonPanel:!0,format:"yyyy-mm-dd",hideIfNoPrevNext:!0,prevText:"",nextText:"",minDate:n,maxDate:"+1Y",showOtherMonths:!1,beforeShowDay:function(n){var t=jQuery.datepicker.formatDate("yy-mm-dd",n);return[between.indexOf(t)===-1]},beforeShow:function(n,t){var i=t.dpDiv;setTimeout(function(){i.position({my:"right top",at:"right bottom",collision:"flip",of:n})},1)}}).click(function(){$(this).attr("style","").removeClass("errorClass")})}}function stringToDate(n,t,i){var e=t.toLowerCase(),r=e.split(i),u=n.split(i),o=r.indexOf("mm"),s=r.indexOf("dd"),h=r.indexOf("yyyy"),f=parseInt(u[o]);return f-=1,new Date(u[h],f,u[s])}function checkTotalPax(){var n=Number($("#iAdults").val())+Number($("#Room2_iAdults").val())+Number($("#Room3_iAdults").val()),t=Number($("#iChildren").val())+Number($("#Room2_iChildren").val())+Number($("#Room3_iChildren").val());return totalPax=n+t,totalPax<=6?!0:(alert("Max guest allowed (adults + children) are 6 !"),!1)}function adultPlus(n){var t,i;n.id.match(isNumber)===null?(t=$("#iAdults"),i=Number(t.val()),i<=6?($(t).val(i+1),checkTotalPax()===!0?"":$(t).val(i)):""):(t=$("#Room"+n.id.match(isNumber)+"_iAdults"),i=Number(t.val()),i<=6?($(t).val(i+1),checkTotalPax()===!0?"":$(t).val(i)):"")}function adultMinus(n){var t;n.id.match(isNumber)===null?(t=$("#iAdults"),nwObjVal=Number(t.val()),t.val()>0?t.val(nwObjVal-1):""):(t=$("#Room"+n.id.match(isNumber)+"_iAdults"),nwObjVal=Number(t.val()),t.val()>0?t.val(nwObjVal-1):"")}function childPlus(n){var t;n.id.match(isNumber)===null?(t=$("#iChildren"),t.val()==="0"?(t.val("1"),checkTotalPax()===!0?childAgeChange(t):t.val("0")):t.val()==="1"?(t.val("2"),checkTotalPax()===!0?childAgeChange(t):t.val("1")):t.val()==="2"?alert("Sorry, only 2 Children per room"):""):(t=$("#Room"+n.id.match(isNumber)+"_iChildren"),t.val()==="0"?(t.val("1"),checkTotalPax()===!0?childAgeChange(t):t.val("0")):t.val()==="1"?(t.val("2"),checkTotalPax()===!0?childAgeChange(t):t.val("1")):t.val()==="2"?alert("Sorry, only 2 Children per room"):"")}function childMinus(n){var t;n.id.match(isNumber)===null?(t=$("#iChildren"),t.val()==="2"?(t.val("1"),childAgeChange(t)):t.val()==="1"?(t.val("0"),childAgeChange(t)):""):(t=$("#Room"+n.id.match(isNumber)+"_iChildren"),t.val()==="2"?(t.val("1"),childAgeChange(t)):t.val()==="1"?(t.val("0"),childAgeChange(t)):"")}function childAgeChange(n){$(n).attr("id").match(isNumber)===null?$('#dvroom1 p[id^="pAge"]').each(function(t,i){i.id.match(isNumber)<=n.val()?($(this).show(),$("#iChild"+this.id.match(isNumber)+"").val("Child "+this.id.match(isNumber)+" Age")):($(this).hide(),$("#iChild"+this.id.match(isNumber)+"").val(""))}):$("#dvroom"+$(n).attr("id").match(isNumber)+' p[id^="pAge"]').each(function(t,i){i.id.match(isNumber)<=n.val()?($(this).show(),$("#Room"+$(n).attr("id").match(isNumber)+"_iChild"+this.id.match(isNumber)+"").val("Child "+this.id.match(isNumber)+" Age")):($(this).hide(),$("#Room"+$(n).attr("id").match(isNumber)+"_iChild"+this.id.match(isNumber)+"").val(""))})}function roomTravelers(n){$("#iRoomsAndPax").val(n.id);$("#roomPaxTxt").html(n.innerHTML);openPaxRoomlist();/Other/.test(n.id)?openRooms(n.id.match(isNumber),0):openRooms(n.id.substring(0,1),n.id.substring(2,3))}function openRooms(n,t){t===0?($("#dvpxperroom").slideDown("slow"),$('div[id^="dvroom"]').each(function(){this.id.match(isNumber)<=n?$(this).slideDown("slow"):($(this).slideUp("slow"),cleanRooms(this))})):($("#dvpxperroom").slideUp("slow"),$('div[id^="dvroom"]').each(function(){this.id.match(isNumber)>1?cleanRooms(this):firstRoom(n,t)}))}function openPaxRoomlist(){$("#dvpxroomlst").is(":visible")===!1?($("#dvpxroomlst").slideDown("slow"),$("#dvpaxRoom").switchClass("dvMdialogRoom","dvMdialogRoomROT")):($("#dvpxroomlst").slideUp("slow"),$("#dvpaxRoom").switchClass("dvMdialogRoomROT","dvMdialogRoom"))}function firstRoom(n,t){$("#iAdults").val(t);$("#iChildren").val(0);$("#iChild1").val("");$("#iChild2").val("");$('#dvroom1 p[id^="pAge"]').each(function(){$(this).hide()})}function cleanRooms(n){$("#"+n.id+"").find("input").each(function(n,t){switch(n){case 0:$("#"+t.id+"").val("0");break;case 1:$("#"+t.id+"").val("0");break;case 2:$("#"+t.id+"").val("");break;case 3:$("#"+t.id+"").val("")}});$("#"+n.id+' p[id^="pAge"]').each(function(){$(this).hide()})}function hidedialog(){var n=1,t=$('div[id^="dvroom"]').length;$('div[id^="dvroom"]').each(function(){$(this).is(":visible")===!0&&$("#"+this.id+' p[id^="pAge"] select').each(function(){$(this).is(":visible")===!0&&(/^[0-9]*$/.test($(this).val())==!1||$(this).val()==""||$(this).val()==null?(errorAlert(this.id,""),n=0,t+=1):$("#"+this.id+"").removeClass("errorClass"))});t-=1;t===0?hidedialogCont():""});$("#iRoomsAndPax").val()=="-1"?($("#dvpaxRoom").addClass("errorClass"),n=0):$("#dvpaxRoom").removeClass("errorClass");n==1&&$("#paxModal").modal("hide")}function hidedialogCont(){var t="",u,n,r,f,i,e;switch($("#Cabin").val()){case"Y":t=", Economy";break;case"W":t=", Premium Economy";break;case"C":t=", Business";break;case"F":t=", First Class"}$("#wCabin").val()==="No"?t="":"";u=$("#iRoomsAndPax").val();n=u.substring(0,1);$("#iRoom").val(n);$("#Rooms").val(n);n=n>1?n+" Rooms":n+" Room";r=u.split("|");i=0;f=/-/.test(r[1])?r[1].split("-"):r[1];for(p in f)i+=Number(f[p]);isNaN(i)?checkTotalPax()===!0?i=Number(totalPax):"":"";haveCook=0;e=n+", "+i+" Travelers"+t;$("#cabinRoomPax").val(e)}function errorAlert(n,t){var i=$("#"+n+"").position();return $("#"+n+"").addClass("errorClass").val(t),window.scroll(0,i.top-100),!1}function callCMS(n,t){$.ajax({type:"Get",url:SiteName+"/Api/Packages/getDataThisCMS/"+n,contentType:"application/json; charset=utf-8",dataType:"json",success:function(n){if(n[0].cmS_Content!="")if(n[0].cmS_Content=n[0].cmS_Content.replace(/http:/g,"https:"),RegExp(/\b(dvCMS\w*)\b/).test(n[0].cmS_Content)==!0)$("#"+t+"").html(n[0].cmS_Content);else return!1},error:function(n){$("#"+t+"").html(n.responseText)}})}function buildFromCook(){var n=jQuery.parseJSON(Cookies.get("mobTBackTMED")),t=0,u=Object.keys(n).length,f=$("#Pkgid").val(),i;for(var r in n)if(r=="Pkgid"){i=n[r];break}f!=i?Cookies.set("mobTBackTMED","",{expires:-1}):jQuery.each(n,function(n,i){$("#"+n+"").val(i);t+=1;t===u?(Cookies.set("mobTBackTMED","",{expires:-1}),$("#addFlight").val()==="False"?($("#btnFly").removeClass("btn-dark"),$("#btnFly").addClass("btn-primary active"),$("#btnWFly").removeClass("btn-primary active").addClass("btn-dark"),$("#iDepCityTxt").collapse("hide"),$("#addFlight").val("False")):""):""})}function validateForm(){if($("#addFlight").val()==="True"&&$("#iDepCity").val()==="-1")return errorAlert("iDepCityTxt","Select a valid departure airport"),!1;$("#iRetCity").val($("#iDepCity").val());var n=$.trim($("#InDate1").val());if(/undefined|Select/.test(n))return errorAlert("InDate1","Select a valid date"),!1;dvPriceIt()}function dvPriceIt(){var n,r=$("#PackType").val(),i=$("#idPack").val(),t;switch(r){case"TP3":_bpURL="https://reservation.tripmasters.com/Tourpackage4/Itinerary/Create";n=_bpURL+"?"+i;break;case"MC":n="http://reservations.tripmasters.com/TVLAPI/Multicity3/MC_ComponentList.ASP?"+i}t="";t=$("#formMobT24-26").serializeObject();Cookies.set("mobTBackTMED",t,{expires:1});$("#utm_campaign").val()==""?$("#utm_campaign").val(""+utmValue+""):"";$("#formMobT24-26").find('input[name^="__RequestVerificationToken"]').remove();$("#formMobT24-26").attr("action",n);$("#formMobT24-26").submit()}function bbdates(n){$("#InDate1").datepicker("destroy");var t=$("#fxNetDates").val();builFixDatediv(t,n);objPOS=$("#"+n+"").offset();$("#dvFixDates").show();$("#dvFixDates").offset({left:objPOS.left-0,top:objPOS.top+52})}function builFixDatediv(n,t){var f,e,o="",r="",u=n.split(","),s,h,c;for(i=0;i<u.length;i++)u[i]!=""&&(h=dateFormat(u[i],"mm/dd/yyyy"),c=dateFormat(new Date,"mm/dd/yyyy"),new Date(h)>new Date(c)&&(o!=dateFormat(u[i],"mmm")&&(o=dateFormat(u[i],"mmm"),s=0,r=i==0?'<div style="padding:3px 1px;background-color:beige;">':r+'<\/div><div style="padding:3px 1px;background-color:beige;">',r=r+" "+o+" "+dateFormat(u[i],"yyyy")+": "),s==0?(f="'"+dateFormat(u[i],"mm/dd/yyyy")+"'",e="'"+t+"'",r=r+'<span id="fxDates" onclick="changeDaysLenght1('+f+","+e+')">'+dateFormat(u[i],"dd")+"<\/span>"):(f="'"+dateFormat(u[i],"mm/dd/yyyy")+"'",e="'"+t+"'",r=r+', <span id="fxDates" onclick="changeDaysLenght1('+f+","+e+')">'+dateFormat(u[i],"dd")+"<\/span>"),s++));r=r+"<\/div>";$("#dvFixDates").html(r);setTimeout(function(){$("#dvFixDates").hide()},7e3)}function changeDaysLenght1(n,t){$("#"+t+"").val(n)}function changeCabin(n){$(".pMdialogCabin").each(function(){this.id===n.id?($("#"+n.id+"").find("span:first").html("&#10003;"),$("#Cabin").val(n.id)):$("#"+this.id+"").find("span:first").html("&nbsp;")})}var verification="",childPax=[{text:"0",value:0},{text:"1",value:1},{text:"2",value:2}],childAge=[],isNumber=/[0-9]+/g,totalPax=0,myDate=new Date,prvCont=[],chilObj,between;for(c=2;c<=11;c++)chilObj={label:c,value:c},childAge.push(chilObj);$(document).ready(function(){$(".dvMpriceIt").is(":visible")==!1?$(".dvMpriceIt").show():"";$(".dvMpriceItNo").is(":visible")==!0?$(".dvMpriceItNo").hide():"";$(".dvMpriceIt").click(function(){validateForm()});packNoNts=$("#packNoNts").val();fixdates=$("#fixDates").val().split(",");blockdates=$("#blockDates").val().split("|");var n=Cookies.get("mobTBackTMED");n!=undefined?(haveCook=1,buildFromCook()):haveCook=0;buildPackImg();$("#dvMFaq, #dvMTransp").on("show.bs.collapse",function(){$("#"+this.id+"").html()==""&&callCMS($("#"+this.id+"CmsId").val(),this.id)});$("#changeNights").on("show.bs.collapse",function(){$("#changeNights").css({"background-color":"#fffce7"});$("#aChgNts").css("background-color","rgb(255, 252, 231)");$("#aChgNts").css("font-weight","700");$("#aChgNts").css("border-bottom","none");$("#aChgNts").css("margin-bottom","0");$("#changeNights").css("border-bottom","1px solid #fad105")});$("#changeNights").on("hide.bs.collapse",function(){$("#aChgNts").removeAttr("style");$("#changeNights").css("border-bottom","none")});$(document).on("click",".dvCMSThreeLinks a, .aCMStxtLink, .spCMSContentText a",function(n){n.preventDefault();var t=$('div[class^="dvCMS"]').closest("[id]").get(0).id,i=$(this).attr("href").match(/\d+/);prvCont.push($("#"+t+"").html());$("#"+t+"Back").removeClass("d-none").addClass("d-block");window.scrollTo(0,$("#"+t+"").offset().top-50);callCMS(i[0],t)});$(".dvCmsBack").click(function(){var n=$(this).attr("id").replace("Back","");prvCont!=""&&($("#"+n+"").html(""),$("#"+n+"").html(prvCont[prvCont.length-1]),prvCont.pop());prvCont==""?$("#"+n+"Back").removeClass("d-block").addClass("d-none"):""});$("#custFeed").on("show.bs.modal",function(){var t=$("#idPack").val(),n="";verification==""&&($.ajax({type:"Get",url:SiteName+"/Api/Packages/GetCustomerFeedbacks/"+t,contentType:"application/json; charset=utf-8",dataType:"json",success:function(t){$.each(t,function(t,i){n='<div class="col-12 dvEachCustFeed pt-3 pb-3 pl-2 pr-2 border border-dark border-bottom-0 border-left-0 border-right-0"><a href="'+SiteName+"/"+i.name.toLowerCase().replace(" ","_")+'/vacations"><p class="font-weight-bold">'+i.name+"<\/p><p>"+i.noOfFeeds+" Customer Feedback<\/p><\/a><\/div>";$(n).insertAfter(".dvEachCustFeed")})},error:function(n){$("#packPics").html(n.responseText)}}),verification="1")});$("#dvpaxRoom").click(function(){openPaxRoomlist()});$("#dvpxroomlst li").click(function(){roomTravelers(this)});$('span[id^="adultPlus"]').click(function(){adultPlus(this)});$('span[id^="adultMinus"]').click(function(){adultMinus(this)});$('span[id^="childrenPlus"]').click(function(){childPlus(this)});$('span[id^="childrenMinus"]').click(function(){childMinus(this)});$(".pMdialogCabin").click(function(){changeCabin(this)});getDeparture();dateByDest();$("#DoneModal").click(function(){hidedialog()});$("#BackModal").click(function(){hidedialog()});$("#btnWFly").on("click",function(){$("#btnWFly").addClass("btn-primary active");$("#btnWFly").removeClass("btn-dark");$("#btnFly").removeClass("btn-primary active").addClass("btn-dark");$("#iDepCityTxt").collapse("show");$("#addFlight").val("True")});$("#btnFly").on("click",function(){$("#btnFly").removeClass("btn-dark");$("#btnFly").addClass("btn-primary active");$("#btnWFly").removeClass("btn-primary active").addClass("btn-dark");$("#iDepCityTxt").collapse("hide");$("#addFlight").val("False")});$(".catSel").change(function(){var t=this.id.match(isNumber),n="";$(".catSel option:selected").each(function(){n+=$(this).text()+" "});$("#ecityCatNA"+t).val(n)});$("#paxModal").on("show.bs.modal",function(){var n=$("#wCabin").val();n==="No"?$("#dvSelectCabin").hide():$("#dvSelectCabin").show();haveCook===1?($('#dvpxroomlst li[id="'+$("#iRoomsAndPax").val()+'"]').trigger("click"),$("#dvpxroomlst").hide(),$('div p[id^="pAge"] select').each(function(){this.value>0?$(this).parent("p").show():""}),$('.pMdialogCabin[id="'+$("#Cabin").val()+'"]').trigger("click")):""})});between=[];$.fn.serializeObject=function(){var n={},t=this.serializeArray();return $.each(t,function(){n[this.name]?(n[this.name].push||(n[this.name]=[n[this.name]]),n[this.name].push(this.value||"")):n[this.name]=this.value||""}),n};