function DisplayHeader(n){const u=$("#TotalPacks").val();$("#idTotalCount").text(u+" Itineraries");const r=Math.ceil(u/20);if(r<=1){$('div[id^="idPages"]').html("");return}let t="";if(t=n==1?'<span class="packages__pag-prev disable"><span class="packages__pag-arrow">&#10094;<\/span> <span class="packages__pag-desk">Previous<\/span><\/span>':'<button class="packages__pag-prev" type="button" onclick="OpenPage('+(n-1)+')"><span class="packages__pag-arrow">&#10094;<\/span> <span class="packages__pag-desk">Previous<\/span><\/button>',r<=6)for(i=1;i<=r;i++)t=i!=n?t+'<button class="packages__pag-page" type="button" onclick="OpenPage('+i+')">'+i+"<\/button>":t+'<span class="packages__pag-page active">'+i+"<\/span>";else if(n<4){for(i=1;i<=4;i++)t=i!=n?t+'<button class="packages__pag-page" type="button" onclick="OpenPage('+i+')">'+i+"<\/button>":t+'<span class="packages__pag-page active">'+i+"<\/span>";t=t+'<span class="packages__pag-page disable">...<\/span>';t=t+'<button class="packages__pag-page" type="button" onclick="OpenPage('+r+')">'+r+"<\/button>"}else if(t=t+'<button class="packages__pag-page" type="button" onclick="OpenPage(1)">1<\/button>',t=t+'<span class="packages__pag-page disable">...<\/span>',n+2<r){for(i=n-1;i<=n+1;i++)t=i!=n?t+'<button class="packages__pag-page" type="button" onclick="OpenPage('+i+')">'+i+"<\/button>":t+'<span class="packages__pag-page active">'+i+"<\/span>";t=t+'<span class="packages__pag-page disable">...<\/span>';t=t+'<button class="packages__pag-page" type="button" onclick="OpenPage('+r+')">'+r+"<\/button>"}else for(i=r-3;i<=r;i++)t=i!=n?t+'<button class="packages__pag-page" type="button" onclick="OpenPage('+i+')">'+i+"<\/button>":t+'<span class="packages__pag-page active">'+i+"<\/span>";t=n==r?t+'<span class="packages__pag-next disable"><span class="packages__pag-desk">Next<\/span> <span class="packages__pag-arrow">&#10095;<\/span><\/span>':t+'<button class="packages__pag-next" type="button" onclick="OpenPage('+(n+1)+')"><span class="packages__pag-desk">Next<\/span> <span class="packages__pag-arrow">&#10095;<\/span><\/button>';window.scrollTo(0,0);$('div[id^="idPages"]').html(t);$(".packages__footer").show()}function EnableUnckechOption(){const n=$('input[type="checkbox"][id^="dotPrice"]:checked').length;$("#uncheckPrice").toggleClass("disable",n===0);const t=$('input[type="checkbox"][id^="dotLen"]:checked').length;$("#uncheckLength").toggleClass("disable",t===0);const i=$('input[type="checkbox"][id^="dotCity"]:checked').length;$("#uncheckCities").toggleClass("disable",i===0)}function UncheckOptions(n){n!="price"&&(n!="all"||$("#uncheckPrice").hasClass("disable"))||$('input[type="checkbox"][id^="dotPrice"]:checked').each(function(){$(this).prop("checked",!1)});n!="length"&&(n!="all"||$("#uncheckLength").hasClass("disable"))||$('input[type="checkbox"][id^="dotLen"]:checked').each(function(){$(this).prop("checked",!1)});n!="city"&&(n!="all"||$("#uncheckCities").hasClass("disable"))||$('input[type="checkbox"][id^="dotCity"]:checked').each(function(){$(this).prop("checked",!1)});EnableUnckechOption();OpenPage(1)}function showOtherCities(){$("#listCities .filter__item-hidden").each(function(){$(this).removeClass("filter__item-hidden")});$("#moreCities").hide()}function BuildFilterExpression(){let n="";$('input[type="checkbox"][id^="dotPrice"]:checked').each(function(){n=n+$(this).val()+"P"});let t="";$('input[type="checkbox"][id^="dotLen"]:checked').each(function(){t=t+$(this).val()+"L"});let i="";$('input[type="checkbox"][id^="dotCity"]:checked').each(function(){i=$(this).val()+"C"+i});return n+"I"+t+"I"+i}function OpenPage(n){$("#dvPackets").hide();$("#dvWaitPacks").show();const t=BuildFilterExpression(),i=$("#IDplace").val(),r=$("#OrderVal").val(),u=new URLSearchParams({plcID:i,filter:t,OrderVal:r,pageNo:n});getPackages(u,n)}async function getPackages(n,t){const i=`${SiteName}/Api/FindAllPackages?${n}`;try{const n=await fetch(i,{method:"GET",headers:{"Content-Type":"application/json;charset=utf-8"}});if(n.status===204)return;if(!n.ok){const t=await n.text();throw new Error(t);}const u=await n.json();if(!u)return;const{totalPackages:r,packages:f}=u;if($("#TotalPacks").val(r),$('select[id^="idOrderBy"]').prop("disabled",r===0),DisplayHeader(t),$("#dvWaitPacks").hide(),r>0)BuildPackets(f);else{$(".packages__footer").hide();const n=`<li class="packages__no-found"><p>No itineraries found. Please try a different combination.</p></li>
                                 <li class="packages__banner">
                                     <a href="/build_your_own_vacation"><img class="lazyload" src="https://pictures.tripmasters.com/siteassets/d/spacer.gif" data-src="https://pictures.tripmasters.com/siteassets/d/BuildOnYourOwn_Large.jpg" alt="banner build your own vacation" aria-label="Build your own vacation" /></a>
                                 </li>`;$("#dvPackets").html(n).show()}}catch(r){console.error("API FindAllPackages: Request failed",r.message)}}function BuildPackets(n){let t="",i="";n.forEach((n,r)=>{i=`${SiteName}/${n.countryname.replace(/\s/g,"_").toLowerCase()}/${n.pdl_title.replace(/\s/g,"_").toLowerCase()}/package-${n.pdlid}`;let f="";n.spd_internalcomments.indexOf("Partially")>=0?f+=`<span>
                                     <img id="imgGuidedPartially${n.pdlid}"
                                          src="https://pictures.tripmasters.com/siteassets/d/GuidedPartially.jpg"
                                          alt="" />
                                 </span>`:n.spd_internalcomments.indexOf("Guided")>=0&&(f+=`<span>
                                     <img id="imgGuided${n.pdlid}"
                                          src="https://pictures.tripmasters.com/siteassets/d/Guided.jpg"
                                          alt="" />
                                 </span>`);let e="",o="",s="";if(n.duration!=""){let t="",i="";n.spd_internalcomments.indexOf("Inflexible package")==-1?(t=n.duration+" to "+(parseInt(n.duration)+Math.round(parseInt(n.duration)/2))+"+ nights",i="by selecting dates, No. of nights in each city and your departure city."):(t=n.duration+" nights",i="by selecting date, and your departure city.");e=`<span class="packages__night">${t}</span>
                         <div class="packages__tooltip">
                             <p>This packages is recommended for ${t}.</p>
                             <p><span>Customize it</span> ${i}</p>
                         </div>`;n.stp_save!=9999&&n.stp_save!=""&&(e=`<span class="packages__night">${t} from </span>
                             <div class="packages__tooltip">
                                  <p>This packages is recommended for ${t}.</p>
                                  <p><span>Customize it</span> ${i}</p>
                             </div>
                             <span>${formatCurrency(n.stp_save,0)}*</span>`,o+=`<span>${t}</span><span> from <span>${formatCurrency(n.stp_save,0)}</span> w/air, hotel & air taxes*</span>`,s=`<p class="packages__includes-info">This sample price includes ALL air taxes & fuel surcharges: priced within the past 7 days for arrival on ${n.stp_starttraveldate}. Choose your own departure city and dates.</p>`)}let h="";if(n.nooffeed!="0"){const t=`${SiteName}/${n.countryname.replace(/\s/g,"_").toLowerCase()}/${n.pdl_title.replace(/\s/g,"_").toLowerCase()}/feedback-${n.pdlid}`;h=`<a class="packages__feedback" href="${t}" target="_blank" rel="noopener noreferrer"> Customer feedback (${n.nooffeed})</a>`}const l=new RegExp(/<[^<>]+>/g);let u=n.spd_description;u=u.replace(l,"");u.length>340&&(u=u.substring(0,340),u=u+" ... ");let c="",a=n.pdl_content.split("\n").map(n=>n.trim()).filter(n=>n);a.forEach(n=>{c+=`<li>${n}</li>`});t+=`<li class="packages__item">
                           <a class="packages__img" href="${i}">
                                <img class="lazyload" src="https://pictures.tripmasters.com/siteassets/d/spacer.gif" data-src="https://pictures.tripmasters.com${n.img_path_url}" alt="View of ${n.pdl_title}" />
                            </a>
                            <div class="packages__info">
                                <div class="packages__wrapper">
                                    <a class="packages__link" href="${i}">
                                        <h3>${n.pdl_title}
                                            ${f}
                                        </h3>
                                    </a>
                                    <div class="packages__price">
                                        ${e}
                                    </div>
                                </div>
                                ${h}
                                <p class="packages__description">${u}</p>
                                <button class="packages__button-includes" type="button" onclick="dvOpenMain('divInfo${n.pdlid}');">Package Includes</button>
                                <div class="packages__includes is-hidden" id="divInfo${n.pdlid}">
                                    <button class="packages__includes-close" type="button" onclick="dvCloseMain('divInfo${n.pdlid}')">âœ–</button>
                                    <h3 class="packages__includes-title">${n.pdl_title}</h3>
                                    <div class="packages__includes-price">
                                        ${o}
                                    </div>
                                    ${s}
                                    <p class="packages__includes-list-title">This ${n.duration} night sample itinerary includes:</p>
                                    <ul class="packages__includes-list">${c}</ul>
                                    <a class="packages__includes-more" href="${i}">More Details</a>
                                </div>
                            </div>
                        </li>`;r==4&&(t+=`<li class="packages__banner">
                            <a href="/build_your_own_vacation">
                                <img class="lazyload" src="https://pictures.tripmasters.com/siteassets/d/spacer.gif" data-src="https://pictures.tripmasters.com/siteassets/d/BuildOnYourOwn_Large.jpg" alt="banner build your own vacation" aria-label="Build your own vacation" />
                            </a>
                        </li>`)});n.length-1<4&&(t+=`<li class="packages__banner">
                            <a href="/build_your_own_vacation">
                                <img class="lazyload" src="https://pictures.tripmasters.com/siteassets/d/spacer.gif" data-src="https://pictures.tripmasters.com/siteassets/d/BuildOnYourOwn_Large.jpg" alt="banner build your own vacation" aria-label="Build your own vacation" />
                            </a>
                        </li>`);$("#dvPackets").html(t);$("#dvPackets").show()}function getOrderValue(){const n=$("#idOrderBy option:selected").val();$("#OrderVal").val(n);OpenPage(1)}function formatCurrency(n){n=n.toString().replace(/\$|\,/g,"");isNaN(n)&&(n="0");sign=n==(n=Math.abs(n));n=Math.floor(n*100+.50000000001);cents=n%100;n=Math.floor(n/100).toString();cents<10&&(cents="0"+cents);for(var t=0;t<Math.floor((n.length-(1+t))/3);t++)n=n.substring(0,n.length-(4*t+3))+","+n.substring(n.length-(4*t+3));return(sign?"":"-")+"$"+n}function dvOpenMain(n){$("#"+n+"").removeClass("is-hidden")}function dvCloseMain(n){$("#"+n+"").addClass("is-hidden")}function openFilterModal(){$("#filterModal").removeClass("is-hidden");$("body").addClass("modal-open")}function closeFilterModal(){$("#filterModal").addClass("is-hidden");$("body").removeClass("modal-open")}$(document).ready(function(){document.querySelectorAll('input[id^="dotPrice"]').forEach(n=>{n.addEventListener("change",()=>{EnableUnckechOption(),OpenPage(1)})});document.querySelectorAll('input[id^="dotLen"]').forEach(n=>{n.addEventListener("change",()=>{EnableUnckechOption(),OpenPage(1)})});document.querySelectorAll('input[id^="dotCity"]').forEach(n=>{n.addEventListener("change",()=>{EnableUnckechOption(),OpenPage(1)})});$(".package__mob-button").on("click",openFilterModal);$("#applyButton, .filter__modal-close").on("click",closeFilterModal);$("#resetFilter").on("click",function(){UncheckOptions("all")});$("#moreCities").on("click",showOtherCities);DisplayHeader(1)});