function init(){var n=$("#plcId").val(),t={Id:n};$.ajax({type:"POST",url:SiteName+"/Api/Activities/GetSSToursByCity",data:JSON.stringify(t),contentType:"application/json; charset=UTF-8",success:function(n){ssObj=n;initSSObj=ssObj;prevInt=0;buildSSList();createPagination()},error:function(n){console.log(n.responseText)}})}function buildSSList(){$(".sslist").html("");var t=page*10,n="",i=prevInt*nxtPg*10,r=ssObj.slice(i,t);ssObj!=""?($.each(r,function(){n=n+"<div class='row mx-auto bg-white mb-2 dvSSdisplay'><div class='col-12'><p>"+this.pdL_Title+"<\/p><\/div><div class='col-4 pr-0'><img class='img-fluid' src='https://pictures.tripmasters.com"+this.imG_Path_URL.toLowerCase()+"' /><\/div><div class='col-8'><span class='d-block dvSdisplay'>Type: <b>"+this.name+"<\/b><\/span><span class='d-block dvSdisplay'>Duration: <b>"+this.durationUnit+"<\/b><\/span>";n=this.rating>0&&this.reviews>0?n+"<span class='d-block dvSdisplay'>Score: <b>"+this.rating+"/5 <\/b>("+this.reviews+" Reviews)<\/span><\/div>":n+"<span class='d-block dvSdisplay'>Score: <b>Not rated yet<\/b> ("+this.reviews+" Reviews)<\/span><\/div>";n=n+"<div class='col-12 pt-3 pb-3'><button class='btn btn-warning btn-block w-60 mx-auto btnDetails' type='button' id='"+this.pdlid+"' data-target='#details' data-toggle='modal'>Tour details<\/button><\/div><\/div>"}),$(".sslist").append(n),$(".totalSS").text(" Total ("+ssObj.length+")")):(buildempty(),$(".totalSS").text(" Total ("+ssObj.length+")"))}function createPagination(){prevInt=0;totPag=Math.ceil(ssObj.length/10);$(".totPag").text("Total: "+totPag);var n="";for(i=1;i<=totPag;i++)n=n+'<option value="'+i+'">'+i+"<\/option>";$(".selPage").html(n);$(".Page").removeClass("d-none").removeAttr("style");$(".pagePrev").parent().addClass("disabled");totPag==1?$(".pageNext").parent().addClass("disabled"):$(".pageNext").parent().removeClass("disabled")}function pagination(n,t){var i,r,u;if($(".pagePrev").parent().removeClass("disabled"),$(".pageNext").parent().removeClass("disabled"),i=t.value,n===undefined)prevInt=i-1,page=i,i==1&&$(".pagePrev").parent().addClass("disabled"),i==totPag&&$(".pageNext").parent().addClass("disabled"),$(".selPage option").each(function(){$(this).val()!=i?$(this).removeAttr("selected"):$(this).val()==i&&$(this).prop("selected","selected")});else if(i=parseInt($(".selPage").val()),n.id==="pagePrev"){if(i===0)return;r=i-1;page=r;prevInt=page-1;r==1&&$(".pagePrev").parent().addClass("disabled");$(".selPage option").each(function(){$(this).val()==i?$(this).removeAttr("selected"):$(this).val()==r&&$(this).prop("selected","selected")})}else n.id==="pageNext"&&($(".pagePrev").parent().removeClass("disabled"),page=i+1,prevInt=page-1,u=page-2,page==totPag&&$(".pageNext").parent().addClass("disabled"),$(".selPage option").each(function(){$(this).val()==i?$(this).removeAttr("selected"):$(this).val()==page&&$(this).prop("selected","selected")}));buildSSList()}function sortBy(n){sortList=ssObj;switch(!0){case/Name/i.test(n):sortList=sortList.sort(function(n,t){return t.pdL_Title<n.pdL_Title?1:t.pdL_Title>n.pdL_Title?-1:0});break;case/Duration/i.test(n):sortList=sortList.sort(function(n,t){return t.durationUnit<n.durationUnit?1:t.durationUnit>n.durationUnit?-1:0});break;case/Type/i.test(n):sortList=sortList.sort(function(n,t){return t.name<n.name?1:t.name>n.name?-1:0})}ssObj=sortList;buildSSList();delete sortList;$("#filterSort").modal("hide")}function applyFilter(){var t=[],n=[];$(".rev:checkbox").each(function(){this.checked?t.push(this.value):""});$.each(t,function(t,i){var r=$.grep(ssObj,function(n){return n.id==i});n=n!=""?n.concat(r):r});console.log(n);ssObj=n;buildSSList();delete n;$("#filterSort").modal("hide")}function filterOnly(n){var u=n.id,i=u.split("|"),t=[],r;t=ssObj;switch(i[0]){case"fav":t=$.grep(ssObj,function(n){return n.pdL_SequenceNo==99});$("fav:checkbox, .rev:checkbox").prop("checked",!1);$("#"+i[1]+"").prop("checked",!0);break;case"rev":t=$.grep(ssObj,function(n){return n.id==i[1]});$("fav:checkbox, .rev:checkbox").prop("checked",!1);$("#chkrev"+i[1]+"").prop("checked",!0);break;case"butGO":r=$("#ssContain").val();/Type/.test(r)?"":t=$.grep(ssObj,function(n){return compareAccent(n.pdL_Title).match(new RegExp(compareAccent(r),"i"))})}ssObj=t;buildSSList();createPagination();$("#filterSort").modal("hide")}function resetFilters(){$(".sslist").val("");$(".rev:checkbox").prop("checked",!0);$(".fav:checkbox").prop("checked",!1);ssObj=initSSObj;buildSSList();createPagination();$("#filterSort").modal("hide")}function buildempty(){$(".sslist").html('<div class="dvSSdisplay" style="text-align:center; font-weight:600"><p>No activities match filter criteria,<\/p><p>please select another combination<\/p><p> and try again.<\/p><p>Thank you!<\/p><\/div>');$(".Page").hide()}function openDetails(n){console.log(n);var t=$.grep(ssObj,function(t){return t.pdlid==n}),i="<div class='row'><div class='col-12 blueText font-16 font-weight-bold'>"+t[0].pdL_Title+" <\/div><div class='col-12 pt-3 text-center'><img class='img-fluid' src='https://pictures.tripmasters.com"+t[0].imG_Path_URL+"' title='"+t[0].pdL_Title+"' /><\/div><div class='col-12 pt-3'><span class='d-block'>Type: <b class='blueText'>"+t[0].name+"<\/b><\/span><span class='d-block'>Duration: <b class='blueText'>"+t[0].durationUnit+"<\/b><span><\/div><div class='col-12'>"+t[0].pdL_Description+"<\/div><\/div>";$(".ssDetails").html(i)}function callCMS(n){console.log(n);$.ajax({ype:"Get",url:SiteName+"/Api/Packages/SqlThisCMS/"+n,contentType:"application/json; charset=utf-8",dataType:"json",success:function(n){console.log(n);var t=JSON.stringify(n);if(n[0].cmS_Content!="")if(n[0].cmS_Content=n[0].cmS_Content.replace(/http:/g,"https:"),RegExp(/\b(dvCMS\w*)\b/).test(n[0].cmS_Content)==!0)$(".modal-body").html(n[0].cmS_Content);else return!1},error:function(n){$(".modal-body").html(n.responseText)}})}function openpoimap(n){var n=$("#plcId").val(),t;ctylocLat=0;ctylocLong=0;t={Id:n};console.log(JSON.stringify(t));$.ajax({type:"POST",url:SiteName+"/Api/Activities/GetPoiByPlaceId/",contentType:"application/json; charset=UTF-8",data:JSON.stringify(t),success:function(n){var t,i,r;objPOI=n;t=0;delete allLatLong;jQuery.each(objPOI,function(){allLatLong.push(this.poI_Longitude+"|"+this.poI_Latitude);allLong.push(this.poI_Longitude);ctylocLat=Number(ctylocLat)+Number(this.poI_Latitude);ctylocLong=Number(ctylocLong)+Number(this.poI_Longitude);t++});delete ctyLatLong;delete dynZoon;ctyLatLong=Number(ctylocLat/t)+"|"+Number(ctylocLong/t);i=Math.max.apply(Math,allLong);r=Math.min.apply(Math,allLong);jQuery.each(allLatLong,function(n,t){bPrt=t.split("|");(bPrt[0]=r)&&(lat1=bPrt[1],long1=bPrt[0]);(bPrt[0]=i)&&(lat2=bPrt[1],long2=bPrt[0]);delete bPrt});delete dynZoom;dynZoom=getDistanceFromLatLonInKm(lat1,long1,lat2,long2);preBuildMap(n)},error:function(n){$("#dvGoogleMap").html(n.responseText)}})}function getDistanceFromLatLonInKm(n,t,i,r){var u=deg2rad(i-n),f=deg2rad(r-t),e=Math.sin(u/2)*Math.sin(u/2)+Math.cos(deg2rad(n))*Math.cos(deg2rad(i))*Math.sin(f/2)*Math.sin(f/2),o=2*Math.atan2(Math.sqrt(e),Math.sqrt(1-e));return 6371*o}function deg2rad(n){return n*(Math.PI/180)}function preBuildMap(){var t,i,n;$(".mapcanvas").show();$(".mapcanvas").css({height:"85vh",margin:"5px"});t=ctyLatLong.split("|");i=t[0];lon=t[1];n=10;switch(!0){case dynZoom<50:n=11;break;case dynZoom>50&&dynZoom<150:n=10;break;case dynZoom>150:n=9}var u={zoom:n,center:new google.maps.LatLng(i,lon),mapTypeId:google.maps.MapTypeId.ROADMAP,mapTypeControl:!0},r=new google.maps.Map(document.getElementById("mapcanvas"),u),f=0;jQuery.each(objPOI,function(){var t;f++;var u=this.poI_Latitude,e=this.poI_Longitude,o=new google.maps.Point(-10,12),i=new MarkerWithLabel({icon:"https://pictures.tripmasters.com/siteassets/d/orange_ball.gif",position:new google.maps.LatLng(u,e),map:r,draggable:!1,raiseOnDrag:!0,labelContent:'<div class="bubbletitle">'+this.poI_Title+"<\/div>",labelAnchor:o,labelInBackground:!1,labelStyle:{opacity:1},title:this.poI_Title,zIndex:8998}),n='<div class="dvBublleStyle">';this.poI_PictureURL!="none"&&(n=n+'<img src="'+this.poI_PictureURL+'" align="left"/>');n=n+'<div style="font-weight:600; color:navy">'+this.poI_Title+"<\/div>";this.poI_Description!="none"&&(n=n+this.poI_Description);n=n+"<\/div>";t=new google.maps.InfoWindow({content:n,size:new google.maps.Size(40,40)});google.maps.event.addListener(i,"click",function(){closePoiInfoW(r,i,t)});infoPOIWindows.push(t)})}function closePoiInfoW(n,t,i){for(var r=0;r<infoPOIWindows.length;r++)infoPOIWindows[r].close();i.open(n,t)}var $loader="<div class='loader'><\/div>",ssObj,page=1,prevInt=0,nxtPg=1,initSSObj,isNumber=/[0-9]+/g,cmsData,prevCont="";$(document).ready(function(){$(document).on("click",".pageNext, .pagePrev",function(n){n.preventDefault();pagination(this,this)});$(".selPage").change(function(){pagination(this.val,this)});$(document).on("show.bs.collapse","#dvRoomFacil",function(){$(".btnRoomFacil").hide()});$(document).on("click",".btnSortby",function(){$(".btnSortby").removeClass("btn-primary").addClass("btn-secondary");$(this).removeClass("btn-secondary").addClass("btn-primary");sortBy(this.textContent)});$("#modalCMS").on("show.bs.modal",function(n){var t=n.relatedTarget.id.match(isNumber);callCMS(t)});$(document).on("click",".aCMStxtLink, .modal-body a",function(n){n.preventDefault();prevCont=$(".modal-body").html();var t=$(this).attr("href").match(/\d+/);callCMS(t[0])});$("#backCms").click(function(){prevCont!=""?($(".modal-body").html(""),$(".modal-body").html(prevCont),prevCont=""):($(".modal-body").html(""),$("#modalCMS").modal("hide"))});$(".backMap").click(function(){$(".modal-body").html("");$("#modalMap").modal("toggle")});$(document).on("click",".aOnly",function(){filterOnly(this)});$(document).on("click","#butGO",function(){filterOnly(this)});$(document).on("click",".btnReset",function(){resetFilters()});$(document).on("click",".btnApply",function(){applyFilter()});$(document).on("click",".btnDetails",function(){openDetails(this.id)});$("#dvMap").click(function(){openpoimap();$("#modalMap").toggle()});init()});var objPOI,ctylocLat=0,ctylocLong=0,allLat=[],allLong=[],allLatLong=[],lat1,lat2,long1,long2,dynZoom,bPrt,infoPOIWindows=[];compareAccent=function(){var n=/[¹²³áàâãäåaaaÀÁÂÃÄÅAAAÆccç©CCÇÐÐèéê?ëeeeeeÈÊË?EEEEE€gGiìíîïìiiiÌÍÎÏ?ÌIIIlLnnñNNÑòóôõöoooøÒÓÔÕÖOOOØŒr®Ršs?ßŠS?ùúûüuuuuÙÚÛÜUUUUýÿÝŸžzzŽZZ]/g,t={"¹":"1","²":"2","³":"3","á":"a","à":"a","â":"a","ã":"a","ä":"a","å":"a",a:"a",a:"a",a:"a","À":"a","Á":"a","Â":"a","Ã":"a","Ä":"a","Å":"a",A:"a",A:"a",A:"a","Æ":"a",c:"c",c:"c","ç":"c","©":"c",C:"c",C:"c","Ç":"c","Ð":"d","Ð":"d","è":"e","é":"e","ê":"e","?":"e","ë":"e",e:"e",e:"e",e:"e",e:"e",e:"e","È":"e","Ê":"e","Ë":"e","?":"e",E:"e",E:"e",E:"e",E:"e",E:"e","€":"e",g:"g",G:"g",i:"i","ì":"i","í":"i","î":"i","ï":"i","ì":"i",i:"i",i:"i",i:"i","Ì":"i","Í":"i","Î":"i","Ï":"i","?":"i","Ì":"i",I:"i",I:"i",I:"i",l:"l",L:"l",n:"n",n:"n","ñ":"n",N:"n",N:"n","Ñ":"n","ò":"o","ó":"o","ô":"o","õ":"o","ö":"o",o:"o",o:"o",o:"o","ø":"o","Ò":"o","Ó":"o","Ô":"o","Õ":"o","Ö":"o",O:"o",O:"o",O:"o","Ø":"o","Œ":"o",r:"r","®":"r",R:"r","š":"s",s:"s","?":"s","ß":"s","Š":"s",S:"s","?":"s","ù":"u","ú":"u","û":"u","ü":"u",u:"u",u:"u",u:"u",u:"u","Ù":"u","Ú":"u","Û":"u","Ü":"u",U:"u",U:"u",U:"u",U:"u","ý":"y","ÿ":"y","Ý":"y","Ÿ":"y","ž":"z",z:"z",z:"z","Ž":"z",Z:"z",Z:"z"};return function(i){return i.replace(n,function(n){return t[n]})}}();