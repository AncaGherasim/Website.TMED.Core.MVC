function getDeparture(){$.ajax({type:"Get",url:SiteName+"/Api/Packages/depCity",contentType:"application/json; charset=utf-8",dataType:"json",success:function(n){var t=n;depCities=$.map(t,function(n){return{label:n.plC_Title+" - "+n.plC_Code,value:n.plC_Title,id:n.plcid}});doitDep()},error:function(n){alert(n.responseText+" = Error")}})}function doitDep(){$("#iDepCityTxt").autocomplete({autoFocus:!0,source:depCities,minLength:3,response:function(n,t){if(t.content.length===0)return alert("No valid airport found"),!1},select:function(n,t){return $("#iDepCityTxt").val(t.item.value).blur(),$("#iDepCity").val(t.item.id),$("#iRetCity").val(t.item.id),!1}}).click(function(){$("#iDepCityTxt").select().removeClass("errorClass")}).data("ui-autocomplete")._renderItem=function(n,t){var i=$("<span><\/span>").text(t.label);return highlightText(this.term,i),$("<li><\/li>").append(i).appendTo(n)};$(".inpChild").autocomplete({autoFocus:!0,source:childAge,minLength:0,select:function(n,t){return $(this).val(t.item.value).blur(),!1},response:function(n,t){t.content.length===0&&(errorAlert(this.id,"No valid age"),$(this).blur())}}).click(function(){$(this).removeClass("errorClass");$(this).val("");$(this).attr("readonly",!1)}).focus(function(){$(this).keydown();$(this).attr("readonly",!0)}).blur(function(){($(this).val()==="0"||$(this).val()==="1")&&errorAlert(this.id,"No valid age")})}function highlightText(n,t){for(var f=$.trim(n).toLowerCase(),i=t.get(0).firstChild,e,u,r;(e=i.data.toLowerCase().indexOf(f))>=0;)u=i.splitText(e),i=u.splitText(f.length),r=document.createElement("span"),r.className="highlight",i.parentNode.insertBefore(r,i),r.appendChild(u)}function dateByDest(){var h=$("#fxNetDates").val(),t,n,f,s,u;if(h!=0)return!1;if(t=$("#blockDates").val(),t==0)n=new Date(myDate.getTime()+6048e5),f='"'+today.getFullYear()+":"+Number(today.getFullYear()+1)+'"',$("#InDate1").datepicker({defaultDate:n,yearRange:f,changeMonth:!1,changeYear:!1,numberOfMonths:1,showButtonPanel:!0,format:"yyyy-mm-dd",hideIfNoPrevNext:!0,prevText:"",nextText:"",minDate:n,showOtherMonths:!1,maxDate:"+365d"}).click(function(){$(this).attr("style","").removeClass("errorClass")});else{t=t.replace("B-","");t=t.trim().split("-");var e=t[0].split("*"),c=t[1].split("*"),y=new Date;for(i=0;i<=e.length-1;i++)for(var l=e[i].trim(),a=c[i].trim(),r=stringToDate(""+a+"","mm/dd/yyyy","/"),v=stringToDate(""+l+"","mm/dd/yyyy","/"),o;v<=r;)o=r.getDate(),between.push(jQuery.datepicker.formatDate("yy-mm-dd",r)),r=new Date(r.setDate(--o));if(n="",n=new Date(myDate.getTime()+6048e5),s=new Date(myDate.getTime()+7776e6),u=jQuery.datepicker.formatDate("yy-mm-dd",n),between.indexOf(u)!=-1){while(between.indexOf(u)!=-1)n.setDate(n.getDate()+1),u=jQuery.datepicker.formatDate("yy-mm-dd",n);s<=n&&$("#InDate1").val(jQuery.datepicker.formatDate("mm/dd/yy",n))}$("#InDate1").datepicker("destroy");$("#InDate1").datepicker({orientation:"top",defaultDate:n,changeMonth:!1,changeYear:!1,numberOfMonths:1,showButtonPanel:!0,format:"yyyy-mm-dd",hideIfNoPrevNext:!0,prevText:"",nextText:"",minDate:n,maxDate:"+1Y",showOtherMonths:!1,beforeShowDay:function(n){var t=jQuery.datepicker.formatDate("yy-mm-dd",n);return[between.indexOf(t)===-1]},beforeShow:function(n,t){var i=t.dpDiv;setTimeout(function(){i.position({my:"right top",at:"right bottom",collision:"flip",of:n})},1)}}).click(function(){$(this).attr("style","").removeClass("errorClass")})}}function stringToDate(n,t,i){var e=t.toLowerCase(),r=e.split(i),u=n.split(i),o=r.indexOf("mm"),s=r.indexOf("dd"),h=r.indexOf("yyyy"),f=parseInt(u[o]);return f-=1,new Date(u[h],f,u[s])}function builtPackImg(){var n,t=$("#idPack").val();$.ajax({type:"Get",url:SiteName+"/Api/Packages/PicsForPacks/"+t,contentType:"application/json; charset=utf-8",dataType:"json",success:function(t){var i=$.grep(t,function(n){return n.pxI_Sequence==0}),r=$.grep(t,function(n){return n.imG_ImageType=="M0"});n=i[0].imG_500Path_URL!=="none"?i[0].imG_500Path_URL:i[0].imG_Path_URL;$(".topImg").attr("src","https://pictures.tripmasters.com"+n);$(".imgItinMap").attr("src","https://pictures.tripmasters.com"+r[0].imG_500Path_URL)},error:function(n){$("#packPics").html(n.responseText)}})}function callCMS(n,t){$.ajax({type:"Get",url:SiteName+"/Api/Packages/SqlThisCMS/"+n,contentType:"application/json; charset=utf-8",dataType:"json",success:function(n){if(n[0].cmS_Content!="")if(n[0].cmS_Content=n[0].cmS_Content.replace(/http:/g,"https:"),RegExp(/\b(dvCMS\w*)\b/).test(n[0].cmS_Content)==!0)$("#"+t+"Content").html(n[0].cmS_Content);else return!1},error:function(n){$("#"+t+"").html(n.responseText)}})}function buildFromCook(){var n=jQuery.parseJSON(Cookies.get("mobTBackTMED")),t=0,u=Object.keys(n).length,f=$("#Pkgid").val(),i;for(var r in n)if(r=="Pkgid"){i=n[r];break}f!=i?Cookies.set("mobTBackTMED","",{expires:-1}):jQuery.each(n,function(n,i){$("#"+n+"").val(i);t+=1;t===u?(Cookies.set("mobTBackTMED","",{expires:-1}),$("#addFlight").val()==="False"?($("#btnFly").removeClass("btn-dark"),$("#btnFly").addClass("btn-primary active"),$("#btnWFly").removeClass("btn-primary active").addClass("btn-dark"),$("#iDepCityTxt").collapse("hide"),$("#addFlight").val("False")):""):""})}function validateForm(){if($("#addFlight").val()==="True"&&$("#iDepCity").val()==="-1")return errorAlert("iDepCityTxt","Select a valid departure airport"),!1;$("#iRetCity").val($("#iDepCity").val());var n=$.trim($("#InDate1").val());if(/undefined|Select/.test(n))return errorAlert("InDate1","Select a valid date"),!1;dvPriceIt()}function changeCabin(n){$(".pMdialogCabin").each(function(){this.id===n.id?($("#"+n.id+"").find("span:first").html("&#10003;"),$("#Cabin").val(n.id)):$("#"+this.id+"").find("span:first").html("&nbsp;")})}function dvPriceIt(){var n,r,t,i;$(".dvMpriceIt").hide();$(".btnWait").show();r=$("#PackType").val();t=$("#idPack").val();switch(r){case"TP3":_bpURL="https://reservation.tripmasters.com/Tourpackage4/Itinerary/Create";n=_bpURL+"?"+t;break;case"MC":n="http://reservations.tripmasters.com/TVLAPI/Multicity3/MC_ComponentList.ASP?"+t}i="";i=$("#formMobT21").serializeObject();Cookies.set("mobTBackTMED",i,{expires:1});$("#utm_campaign").val()==""?$("#utm_campaign").val(""+utmValue+""):"";$("#formMobT21").find('input[name^="__RequestVerificationToken"]').remove();$("#formMobT21").attr("action",n);$("#formMobT21").submit();setTimeout(function(){$(".dvMpriceIt").show();$(".btnWait").hide()},3e3)}function checkTotalPax(){var n=Number($("#iAdults").val())+Number($("#Room2_iAdults").val())+Number($("#Room3_iAdults").val()),t=Number($("#iChildren").val())+Number($("#Room2_iChildren").val())+Number($("#Room3_iChildren").val());return totalPax=n+t,totalPax<=6?!0:(alert("Max guest allowed (adults + children) are 6 !"),!1)}function adultPlus(n){var t,i;n.id.match(isNumber)===null?(t=$("#iAdults"),i=Number(t.val()),i<=6?($(t).val(i+1),checkTotalPax()===!0?"":$(t).val(i)):""):(t=$("#Room"+n.id.match(isNumber)+"_iAdults"),i=Number(t.val()),i<=6?($(t).val(i+1),checkTotalPax()===!0?"":$(t).val(i)):"")}function adultMinus(n){var t;n.id.match(isNumber)===null?(t=$("#iAdults"),nwObjVal=Number(t.val()),nwObjVal>1?t.val(nwObjVal-1):(alert("At least one adult should be present at room 1!"),t.val("1"))):(t=$("#Room"+n.id.match(isNumber)+"_iAdults"),nwObjVal=Number(t.val()),nwObjVal>1?t.val(nwObjVal-1):(alert("At least one adult should be present at room "+n.id.match(isNumber)+"!"),t.val("1")))}function childPlus(n){var t;n.id.match(isNumber)===null?(t=$("#iChildren"),t.val()==="0"?(t.val("1"),checkTotalPax()===!0?childAgeChange(t):t.val("0")):t.val()==="1"?(t.val("2"),checkTotalPax()===!0?childAgeChange(t):t.val("1")):t.val()==="2"?alert("Sorry, only 2 Children per room"):""):(t=$("#Room"+n.id.match(isNumber)+"_iChildren"),t.val()==="0"?(t.val("1"),checkTotalPax()===!0?childAgeChange(t):t.val("0")):t.val()==="1"?(t.val("2"),checkTotalPax()===!0?childAgeChange(t):t.val("1")):t.val()==="2"?alert("Sorry, only 2 Children per room"):"")}function childMinus(n){var t;n.id.match(isNumber)===null?(t=$("#iChildren"),t.val()==="2"?(t.val("1"),childAgeChange(t)):t.val()==="1"?(t.val("0"),childAgeChange(t)):""):(t=$("#Room"+n.id.match(isNumber)+"_iChildren"),t.val()==="2"?(t.val("1"),childAgeChange(t)):t.val()==="1"?(t.val("0"),childAgeChange(t)):"")}function childAgeChange(n){$(n).attr("id").match(isNumber)===null?$('#dvroom1 p[id^="pAge"]').each(function(t,i){i.id.match(isNumber)<=n.val()?($(this).show(),$("#iChild"+this.id.match(isNumber)+"").val("Child "+this.id.match(isNumber)+" Age")):($(this).hide(),$("#iChild"+this.id.match(isNumber)+"").val(""))}):$("#dvroom"+$(n).attr("id").match(isNumber)+' p[id^="pAge"]').each(function(t,i){i.id.match(isNumber)<=n.val()?($(this).show(),$("#Room"+$(n).attr("id").match(isNumber)+"_iChild"+this.id.match(isNumber)+"").val("Child "+this.id.match(isNumber)+" Age")):($(this).hide(),$("#Room"+$(n).attr("id").match(isNumber)+"_iChild"+this.id.match(isNumber)+"").val(""))})}function roomTravelers(n){$("#iRoomsAndPax").val(n.id);$("#roomPaxTxt").html(n.innerHTML);openPaxRoomlist();/Other/.test(n.id)?openRooms(n.id.match(isNumber),0):openRooms(n.id.substring(0,1),n.id.substring(2,3))}function openRooms(n,t){t===0?($("#dvpxperroom").slideDown("slow"),$('div[id^="dvroom"]').each(function(){this.id.match(isNumber)<=n?$(this).slideDown("slow"):($(this).slideUp("slow"),cleanRooms(this))})):($("#dvpxperroom").slideUp("slow"),$('div[id^="dvroom"]').each(function(){this.id.match(isNumber)>1?cleanRooms(this):firstRoom(n,t)}))}function openPaxRoomlist(){$("#dvpxroomlst").is(":visible")===!1?($("#dvpxroomlst").slideDown("slow"),$("#dvpaxRoom").switchClass("dvMdialogRoom","dvMdialogRoomROT")):($("#dvpxroomlst").slideUp("slow"),$("#dvpaxRoom").switchClass("dvMdialogRoomROT","dvMdialogRoom"))}function firstRoom(n,t){$("#iAdults").val(t);$("#iChildren").val(0);$("#iChild1").val("");$("#iChild2").val("");$('#dvroom1 p[id^="pAge"]').each(function(){$(this).hide()})}function cleanRooms(n){$("#"+n.id+"").find("input").each(function(n,t){switch(n){case 0:$("#"+t.id+"").val("0");break;case 1:$("#"+t.id+"").val("0");break;case 2:$("#"+t.id+"").val("");break;case 3:$("#"+t.id+"").val("")}});$("#"+n.id+' p[id^="pAge"]').each(function(){$(this).hide()})}function errorAlert(n,t){var i=$("#"+n+"").position();return $("#"+n+"").addClass("errorClass"),/qNACity/.test(n)?$("#"+n+"").val(t):alert(t),window.scroll(0,i.top-100),!1}function getCookie(n){return document.cookie.length>0&&(c_start=document.cookie.indexOf(n+"="),c_start!=-1)?(c_start=c_start+n.length+1,c_end=document.cookie.indexOf(";",c_start),c_end==-1&&(c_end=document.cookie.length),unescape(document.cookie.substring(c_start,c_end))):null}function hidedialog(){var n=Number($('div[id^="dvroom"]:visible').length);$('div[id^="dvroom"]').each(function(){if($(this).is(":visible")===!0){var i=0,t=this.id.match(isNumber),r=!0,u=!0;if(i=t==1?$(".inpAdult").val():$("#Room"+t+"_iAdults").val(),i==""||i==0?r=t==null?errorAlert("iAdults","Should be at least 1 adult in Room 1"):errorAlert("Room"+t+"_iAdults","Should be at least 1 adult in Room"+t):"",r==!1)return!1;$("#"+this.id+' p[id^="pAge"] select').each(function(){if($(this).is(":visible")==!0){var i=$(this).val();i==""||i==null||i==0?(u=errorAlert(this.id,"Room"+t+": Child age is missing"),n++):$("#"+this.id+"").removeClass("errorClass")}})}if(!u)return!1;n--});n===0?hidedialogCont():""}function hidedialogCont(){var t="",u,n,r,f,i,e;switch($("#Cabin").val()){case"Y":t=", Economy";break;case"W":t=", Premium Economy";break;case"C":t=", Business";break;case"F":t=", First Class"}$("#wCabin").val()==="No"?t="":"";u=$("#iRoomsAndPax").val();n=u.substring(0,1);$("#iRoom").val(n);$("#Rooms").val(n);n=n>1?n+" Rooms":n+" Room";r=u.split("|");i=0;f=/-/.test(r[1])?r[1].split("-"):r[1];for(p in f)i+=Number(f[p]);isNaN(i)?checkTotalPax()===!0?i=Number(totalPax):"":"";haveCook=0;e=n+", "+i+" Travelers"+t;$("#cabinRoomPax").val(e);$("#paxModal").modal("hide")}function bbdates(n){builFixDatediv(fixDatesdiv,n);objPOS=$("#"+n+"").offset();$("#dvFixDates").show();$("#dvFixDates").offset({left:objPOS.left-0,top:objPOS.top+20})}function builFixDatediv(n,t){var f,e,s="",r="",u=n.split(","),o;for(i=0;i<u.length;i++)s!=dateFormat(u[i],"mmm")&&(s=dateFormat(u[i],"mmm"),o=0,r=i==0?'<div style="padding:3px 1px;background-color:beige;">':r+'<\/div><div style="padding:3px 1px;background-color:beige;">',r=r+" "+s+" "+dateFormat(u[i],"yyyy")+": "),o==0?(f="'"+dateFormat(u[i],"mm/dd/yyyy")+"'",e="'"+t+"'",r=r+'<span id="fxDates" onclick="changeDaysLenght1('+f+","+e+')">'+dateFormat(u[i],"dd")+"<\/span>"):(f="'"+dateFormat(u[i],"mm/dd/yyyy")+"'",e="'"+t+"'",r=r+', <span id="fxDates" onclick="changeDaysLenght1('+f+","+e+')">'+dateFormat(u[i],"dd")+"<\/span>"),o=o+1;r=r+"<\/div>";$("#dvFixDates").html(r);setTimeout(function(){$("#dvFixDates").hide()},7e3)}function changeDaysLenght1(n,t){$("#"+t+"").val(n)}var verification="",childPax=[{text:"0",value:0},{text:"1",value:1},{text:"2",value:2}],childAge=[],isNumber=/[0-9]+/g,totalPax=0,myDate=new Date,prvCont=[],fixDatesdiv,fixedDays=[],fxDatesNET,chilObj,between;for(c=2;c<=11;c++)chilObj={label:c,value:c},childAge.push(chilObj);$(document).ready(function(){var i,n,t;$(".dvMpriceIt").is(":visible")==!1?$(".dvMpriceIt").show():"";$(".dvMpriceIt").click(function(){validateForm()});packNoNts=$("#packNoNts").val();fixdates=$("#fixDates").val().split(",");fxDatesNET=$("#fxNetDates").val();fixedDays=fxDatesNET;fixDatesdiv=fxDatesNET;blockdates=$("#blockDates").val().split("|");i=Cookies.set("mobTBackTMED");i!=undefined?(haveCook=1,buildFromCook()):haveCook=0;$("#paxModal").on("show.bs.modal",function(){console.log("cabinRoomPax show.bs.modal");var n=$("#wCabin").val();n==="No"?$("#dvSelectCabin").hide():$("#dvSelectCabin").show();console.log("haveCook = "+haveCook);haveCook===1?($('#dvpxroomlst li[id="'+$("#iRoomsAndPax").val()+'"]').trigger("click"),$("#dvpxroomlst").hide(),$('div p[id^="pAge"] select').each(function(){this.value>0?$(this).parent("p").show():""}),$('.pMdialogCabin[id="'+$("#Cabin").val()+'"]').trigger("click")):""});n=getCookie("utmcampaign");n!=null&&(t=n.split("="),$("#utm_campaign").length!=0&&($("#utm_campaign").val(jQuery.trim(t[1])),$("#valCook").html(t[1])));builtPackImg();$("#dvMFaq, #dvMItin, #dvMTransp").on("show.bs.collapse",function(){$("#"+this.id+"Content").html()==""&&callCMS($("#"+this.id+"CmsId").val(),this.id)});$("#changeNights").on("show.bs.collapse",function(){$("#changeNights").css({"background-color":"#fffce7"});$("#aChgNts").css("background-color","rgb(255, 252, 231)");$("#aChgNts").css("font-weight","700");$("#aChgNts").css("border-bottom","none");$("#aChgNts").css("margin-bottom","0");$("#changeNights").css("border-bottom","1px solid #fad105")});$("#changeNights").on("hide.bs.collapse",function(){$("#aChgNts").removeAttr("style");$("#changeNights").css("border-bottom","none")});$(document).on("click",".dvCMSThreeLinks a, .aCMStxtLink, .spCMSContentText a",function(n){n.preventDefault();var t=$(this).closest('div[id^="dvM"]').attr("id"),i=t.substring(0,t.indexOf("Content")),r=$(this).attr("href").match(/\d+/);prvCont.push($("#"+t+"").html());$("#"+i+"Back").removeClass("d-none").addClass("d-block");window.scrollTo(0,$("#"+t+"").offset().top-50);callCMS(r[0],i)});$(".dvCmsBack").click(function(){var n=$(this).attr("id").replace("Back","");prvCont!=""&&($("#"+n+"Content").html(""),$("#"+n+"Content").html(prvCont[prvCont.length-1]),prvCont.pop());prvCont==""?$("#"+n+"Back").removeClass("d-block").addClass("d-none"):""});$("#custFeed").on("show.bs.modal",function(){var t=$("#idPack").val(),n="";verification==""&&($.ajax({type:"Get",url:SiteName+"/Api/Packages/GetCustomerFeedbacks/"+t,contentType:"application/json; charset=utf-8",dataType:"json",success:function(t){$.each(t,function(t,i){n='<div class="col-12 dvEachCustFeed pt-3 pb-3 pl-2 pr-2 border border-dark border-bottom-0 border-left-0 border-right-0"><a asp-controller="Package" asp-action="Index" asp-route-Country="'+i.name+'" asp-route-id="'+i.id+'"><p class="font-weight-bold">'+i.name+"<\/p><p>"+i.noOfFeeds+" Customer Feedback<\/p><\/a><\/div>";$(n).insertAfter(".dvEachCustFeed")})},error:function(n){$("#packPics").html(n.responseText)}}),verification="1")});$("#dvpaxRoom").click(function(){openPaxRoomlist()});$("#dvpxroomlst li").click(function(){roomTravelers(this)});$('span[id^="adultPlus"]').click(function(){$('input[id^="Room'+Number(this.id.match(isNumber))+'_"').removeClass("errorClass");adultPlus(this)});$('span[id^="adultMinus"]').click(function(){$('input[id^="Room'+Number(this.id.match(isNumber))+'_"').removeClass("errorClass");adultMinus(this)});$('span[id^="childrenPlus"]').click(function(){childPlus(this)});$('span[id^="childrenMinus"]').click(function(){childMinus(this)});$(".pMdialogCabin").click(function(){changeCabin(this)});$('#iAdults, input[id^="Room"], select[id^="Room"], select[id^=iChild]').click(function(){$(this).removeClass("errorClass")});getDeparture();dateByDest();$("#DoneModal").click(function(){hidedialog()});$("#BackModal").click(function(){hidedialog()});$("#btnWFly").on("click",function(){$("#btnWFly").addClass("btn-primary active");$("#btnWFly").removeClass("btn-dark");$("#btnFly").removeClass("btn-primary active").addClass("btn-dark");$("#iDepCityTxt").collapse("show");$("#addFlight").val("True")});$("#btnFly").on("click",function(){$("#btnFly").removeClass("btn-dark");$("#btnFly").addClass("btn-primary active");$("#btnWFly").removeClass("btn-primary active").addClass("btn-dark");$("#iDepCityTxt").collapse("hide");$("#addFlight").val("False")})});between=[];$.fn.serializeObject=function(){var n={},t=this.serializeArray();return $.each(t,function(){n[this.name]?(n[this.name].push||(n[this.name]=[n[this.name]]),n[this.name].push(this.value||"")):n[this.name]=this.value||""}),n};