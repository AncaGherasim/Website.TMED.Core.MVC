function getRecentlyView(){var n={};n.url=SiteName+"/Api/RecentlyViewed";n.type="POST";n.contentType="application/json; charset=utf-8";n.data=JSON.stringify({Id:visitId});n.dataType="json";n.success=function(n){console.log(n);n!=undefined?buildRecentlyViewed(n):""};n.error=function(n){console.log(n)};$.ajax(n)}function buildRecentlyViewed(n){var r=0,i,t="<div class='row w-100 mx-auto border-bottom'>";$.each(n,function(){if(r++,r<6){switch(this.UTS_Site){case"ED":i=location.protocol+"//www.europeandestinations.com";break;case"TMED":i=location.protocol+"//www.tripmasters.com/europe";break;case"TMASIA":i=location.protocol+"//www.tripmasters.com/asia";break;case"TMLD":i=location.protocol+"//www.tripmasters.com/latin"}var n=new Date(parseInt(this.UTS_Date.substring(6))),u=new Date,f=Date.timeBetween(n,u);t=t+"<div class='col-6 pt-2 pb-2 pl-2 pr-2'><a href='"+i+"/"+this.STR_PlaceTitle.replace(/ /g,"_").toLowerCase()+"/"+this.PDL_Title.replace(/ /g,"_").toLowerCase()+"/package-"+this.PDLID+"' class='font12'><img class='img-fluid' src='https://pictures.tripmasters.com"+this.IMG_Path_URL.toLowerCase()+"' title='"+this.PDL_Title+"'/><\/a><div class='row' style='height:130px;padding-left: 17px;padding-right: 10px'><a style='height:80px' href='"+i+"/"+this.STR_PlaceTitle.replace(/ /g,"_")+"/"+this.PDL_Title.replace(/ /g,"_")+"/package-"+this.PDLID+"'>"+this.PDL_Title+"<\/a><span class='d-block font12'>Viewed "+f+"<\/span>";this.feedbacks>0&&(t=t+"<div class='col pl-0 pr-0'><a href='"+i+"/"+this.STR_PlaceTitle.replace(/%20|\s/g,"_").toLowerCase()+"/"+this.PDL_Title.replace(/ /g,"_").toLowerCase()+"/feedback-"+this.PDLID+"' class='font12'>"+this.feedbacks+" Customer Reviews <img src='https://pictures.tripmasters.com/siteassets/d/IMG-Feed.jpg' border='0' align='absmiddle'/><\/a><\/div>");t=t+"<\/div>";t=t+"<div class='col pl-0 pr-0 font12 pt-2 text-center mx-auto'><a role='button' href='"+i+"/"+this.STR_PlaceTitle.replace(/ /g,"_")+"/"+this.PDL_Title.replace(/ /g,"_")+"/package-"+this.PDLID+"' class='btn btn-warning'>View It<\/a><\/div><\/div>"}});t=t+"<\/div>";$(".dvMvisit").append(t)}function datePicker(){var n=new Date(today.getTime()+6048e5),t='"'+today.getFullYear()+":"+Number(today.getFullYear()+1)+'"';$("#qArrDate").datepicker({defaultDate:n,yearRange:t,changeMonth:!1,changeYear:!1,numberOfMonths:1,showButtonPanel:!0,format:"yyyy-mm-dd",hideIfNoPrevNext:!0,prevText:"",nextText:"",minDate:n,showOtherMonths:!1,maxDate:"+365d"}).click(function(){$(this).removeClass("border-warning")})}function callTransportation(){var t,n;$(".btnMcont").attr("disabled",!0);switch(!0){case $("#qLeaveID").val()==="-1":return $("#qLeaveNA").addClass("border-warning"),!1;case $("#qArrDate").val()==="mm/dd/yyyy":return $("#qArrDate").addClass("border-warning"),!1;case $('input[id^="qIDCity"]').length>0:for(t=$('input[id^="qIDCity"]').length,i=1;i<=t;i++){if($("#qIDCity"+i+"").val()==="-1"&&$("#qNACity"+i+"").val()=="City name")return $("#qNACity"+i+"").addClass("border-danger"),!1;if($("#qIDCity"+i+"").val()==="-1")return errorAlert("qNACity"+i,$("#qNACity"+i+"").val()),!1}}n="";n=$("#frmMobBYO").serializeObject();Cookies.set("backCookMhome",n,{expires:1});console.log(Cookies.get("backCookMhome"));stringForm=$("#frmMobBYO").serialize();stringForm=stringForm.substr(0,stringForm.indexOf("&__RequestVerificationToken"));console.log(stringForm);$.ajax({type:"POST",url:SiteName+"/api/Packages/webservTransportationOption",contentType:"application/json",data:JSON.stringify(stringForm),dataType:"json",success:function(n){cityData=n.Cities;console.log(cityData);buildTransportationFrom()},error:function(n){alert(n.responseText+" = Error webservGetTransp")}})}function buildTransportationFrom(){var n;console.log(Cookies.get("backCookMhome"));n=JSON.parse(Cookies.get("backCookMhome"));$(".loader").hide();$("#dvTransportR").html("");var u='<div class="form-row col-12 dvMBYOfrom border-bottom border-primary mt-2 pl-0 pr-0"><div class="form-group col-8"><label class="mb-0">From<\/label><input type="text" id="xDepCode" class="pdepcode d-block form-control border-0 p-0 mt-2" readonly="readonly" value="'+n.qLeaveCO+'" /><input type="hidden" id=xLeaveCO" name="xLeaveCO" value="'+n.qLeaveNA+'"/><input type="text" id="xDepCity" class="pdepcity b-block form-control border-0 p-0" readonly="readonly" value="'+n.qLeaveNA+'" /><input type="hidden" id="xtxtLeavingFrom" name="xtxtLeavingFrom" value="'+n.qLeaveNA+'" /><input type="hidden" id="xidLeavingFrom" name="xidLeavingFrom" value="'+n.qLeaveID+'" /><input type="hidden" id="xxCabin" name="xxCabin" value="Y"/><\/div><div class="form-group col-4"><label class="mb-4">Arrival Date<\/label><input type="text" id=xtxtBYArriving name="xtxtBYArriving" class="form-control border-0 p-0" readonly="readonly" value="'+n.qArrDate+'"  /><\/div><\/div>',i=[],t="",r=0,f=0,e=Object.keys(n).length-1;$.each(n,function(n,o){n.match(/\d+/g)!=null&&(r!=n.match(/\d+/g)&&(r=Number(n.match(/\d+/g)),r>1?(i.push(t),t=""):"",t=t+n.match(isNumber)+"@"+o),/qNACity/.test(n)===!1?t=t+"@"+o:"");f++;f===e?(i.push(t),t="",$("#dvTransportR").html(""),$("#dvTransportR").append(u),buildTransportationTo(i),u=""):""})}function buildTransportationTo(t){var i="",o=cityData.length,r,u,s,h,f,e;if(o===undefined){for(r=JSON.parse(JSON.stringify(cityData)),u=t[0].split("@"),i=i+'<div id="cityTo'+r.No+'" class="dvMto form-row col-12 pl-0 pr-0 border-primary border-bottom"><span class="form-group col-8"><label>To<\/label><p id="xArrCode'+r.No+'" class="parrcode" style="display:block">'+u[3].trim()+'<\/p><p id="xArrCity'+r.No+'" class="parrcity" style="display:block; border-bottom:none">'+u[1]+'<\/p><input type="hidden" id="xNOCity'+r.No+'" name="xNOCity'+r.No+'" value="'+r.No+'" /><input name="xNACity'+r.No+'" type="hidden" id="xNACity'+r.No+'" value="'+u[1]+'"/><input type="hidden" name="xIDCity'+r.No+'"  id="xIDCity'+r.No+'" value="'+u[2]+'"  /><input name="xCOCitx'+r.No+'" type="hidden" id="xCOCitx'+r.No+'" value="'+u[3].trim()+'"/><input name="xAPICity'+r.No+'" type="hidden" id="xAPICity'+r.No+'" value="'+u[4].replace(/\%\7C/g,"|").trim()+'"/><\/span><span class="form-group col-4"><label class="mb-2">Number of nights<\/label><p id="xArrNoCode'+r.No+'" class="parrnocode" style="display:block">&nbsp;<\/p><select class="form-control border-bottom border-left-0 border-right-0 border-top-0 pl-0" name="xSTCity'+r.No+'" id="xSTCity'+r.No+'">',n=1;n<=14;n++)h=n===1?"night":"nights",s=n===Number(u[5])?"selected":"",i=i+'<option value="'+n+'" '+s+" >"+n+" "+h+"<\/option>";i=i+'<\/select><button class="close position-relative nxtX" id="xspClose" type="button" aria-label="Close"><span aria-hidden="true">&times;<\/span><\/button><\/div>'}else f="",e=0,$.each(cityData,function(){var h,l,y,w,p,c,b,k,a,d;if(isNaN(Number(this.No))===!0){if(this.No==="S"){if(h=t[0].split("@"),i=i+'<div id="cityTo'+this.No+'" class="dvMto form-row col-12 pl-0 pr-0 border-primary border-bottom"><span class="S"><font>&#9632;<\/font> Must arrive to <b>'+this.PlaceName+'<\/b><\/span><input type="hidden" id="xNOCity'+this.No+'" name="xNOCity'+this.No+'" value="'+this.No+'" /><input name="xNACity'+this.No+'" type="hidden" id="xNACity'+this.No+'" value="'+this.PlaceName+'"/><input type="hidden" name="xIDCity'+this.No+'"  id="xIDCity'+this.No+'" value="'+this.PlaceID+'"  /><input name="xCOCitx'+this.No+'" type="hidden" id="xCOCitx'+this.No+'" value="'+h[3].trim()+'"/><input name="xAPICity'+this.No+'" type="hidden" id="xAPICity'+this.No+'" value="'+h[4].replace(/\%\7C/g,"|").trim()+'"/><input type="hidden" id="xSTCity'+this.No+'" name="xSTCity'+this.No+'" value="0"/>',this.Options!==undefined){var r=this.No,u=this.Options,s="spTransActive",v=1;i=i+'<div class="dvMtravelto" id="dvMtravelTo'+r+'">';u.Ranking===undefined?$.each(u,function(){var n,t;this.Ranking===1?(i=i+'<input name="xFIELDCityS" type="hidden" id="xFIELDCityS" value="'+this.ProductFreeField1+'"/>',i=i+'<input name="xTRANSCityS" type="hidden" id="xTRANSCityS" value="'+this.ProductType+'"/>',i=i+'<input type="hidden" id="xOVNCityS" name="xOVNCityS" value="'+this.Overnight+'"/>',i=i+'<div class="spTransActive" id="spTransRankS'+this.Ranking+'" data-type="'+this.ProductType+'" data-field="'+this.ProductFreeField1+'" data-ovrnts="'+this.Overnight+'"><font class="spSlegend">Transfer to '+h[1]+'<\/font> <img src="https://pictures.tripmasters.com/siteassets/m/'+this.ProductTypeName.replace(/\s/g,"_").toLowerCase()+'_icon.gif" align="absmiddle"/><span class="spMtransp">&#10095;<\/span>',this.Overnight===1?i=i+"&nbsp;&nbsp;  Overnight train":"",i=i+"<\/div>",s="spTransNoActive"):(i=i+'<div class="spTransNoActive" id="spTransRankS'+this.Ranking+'" data-type="'+this.ProductType+'" data-field="'+this.ProductFreeField1+'" data-ovrnts="'+this.Overnight+'"><font class="spSlegend">Transfer to '+h[1]+'<\/font> <img src="https://pictures.tripmasters.com/siteassets/m/'+this.ProductTypeName.replace(/\s/g,"_").toLowerCase()+'_icon.gif" align="absmiddle"/><span class="spMtransp">&#10095;<\/span>',this.Overnight===1?i=i+"&nbsp;&nbsp;  Overnight train":"",i=i+"<\/div>",v++);this.ProductType==="C"&&(n="none",this.Ranking===1?n="block":"",i=i+'<br style="clear:both"/><div id="dvCarOpt'+r+'" class="dvCarOpt" style="display:'+n+'">',i=i+'<div><span class="pikdrp"><label>Pick-up<\/label><input id="xpickupPlaceCity'+r+'" name="xpickupPlaceCity'+r+'"  type="text" value="Airport"/><\/span><span class="when"><label>When<\/label><select id="xpickupDayCity'+r+'" name="xpickupDayCity'+r+'"><option  value="F">First Day<\/option><option value"L">Last Day<\/option><\/select><\/span><br style="clear:both"/><\/div>',i=i+'<div class="dvoff"><span class="pikdrp"><label>Drop-off<\/label><input id="xdropoffPlaceCity'+r+'" name="xdropoffPlaceCity'+r+'" type="text" value="Airport"/><\/span><span class="when"><label>When<\/label><select id="xdropoffDayCity'+r+'" name="xdropoffDayCity'+r+'"><option value="F">First Day<\/option><option value="L">Last Day<\/option><\/select><\/span><span class="where"><label>Where<\/label><select id="xdropoffCity'+r+'" name="xdropoffCity'+r+'">',this.CarDropOff.DOCity.DOPlaceNo!==undefined?(i=i+'<option value="'+this.CarDropOff.DOCity.DOPlaceNo+'">'+decodeURIComponent(this.CarDropOff.DOCity.DOPlaceName)+"<\/option>",this.Ranking===1&&(e=this.CarDropOff.DOCity.DOPlaceNo,f=r)):(t=this.CarDropOff.DOCity,this.Ranking===1&&(e=t[0].DOPlaceNo,f=r),$.each(t,function(){i=i+'<option value="'+this.DOPlaceNo+'">'+decodeURIComponent(this.DOPlaceName)+"<\/option>"})),i=i+'<\/select><\/span><br style="clear:both"/><\/div>',i=i+"<\/div>");i=i+"<\/span>"}):(this.Ranking===1?(i=i+'<input name="xFIELDCityS" type="hidden" id="xFIELDCityS" value="'+u.ProductFreeField1+'"/>',i=i+'<input name="xTRANSCityS" type="hidden" id="xTRANSCityS" value="'+u.ProductType+'"/>',i=i+'<input type="hidden" id="xOVNCityS" name="xOVNCityS" value="'+u.Overnight+'"/>',i=i+'<div class="spTransActive" id="spTransRankS'+u.Ranking+'" data-type="'+u.ProductType+'" data-field="'+u.ProductFreeField1+'" data-ovrnts="'+u.Overnight+'"><font class="spSlegend">Transfer to '+h[1]+'<\/font> <img src="https://pictures.tripmasters.com/siteassets/m/'+this.ProductTypeName.replace(/\s/g,"_").toLowerCase()+'_icon.gif" align="absmiddle"/><span class="spMtransp">&#10095;<\/span>',u.Overnight===1?i=i+"&nbsp;&nbsp;  Overnight train":"",i=i+"<\/div>",s="spTransNoActive"):(i=i+'<div class="spTransNoActive" id="spTransRankS'+u.Ranking+'" data-type="'+u.ProductType+'" data-field="'+u.ProductFreeField1+'" data-ovrnts="'+u.Overnight+'"><font class="spSlegend">Transfer to '+h[1]+'<\/font> <img src="https://pictures.tripmasters.com/siteassets/m/'+u.ProductTypeName.replace(/\s/g,"_").toLowerCase()+'_icon.gif" align="absmiddle"/><span class="spMtransp">&#10095;<\/span>',u.Overnight===1?i=i+"&nbsp;&nbsp;  Overnight train":"",i=i+"<\/div>",v++),u.ProductType==="C"&&(l="none",u.Ranking===1?l="block":"",i=i+'<br style="clear:both"/><div id="dvCarOpt'+r+'" class="dvCarOpt" style="display:'+l+'">',i=i+'<div><span class="pikdrp"><label>Pick-up<\/label><input id="xpickupPlaceCity'+r+'" name="xpickupPlaceCity'+r+'"  type="text" value="Airport"/><\/span><span class="when"><label>When<\/label><select id="xpickupDayCity'+r+'" name="xpickupDayCity'+r+'"><option  value="F">First Day<\/option><option value"L">Last Day<\/option><\/select><\/span><br style="clear:both"/><\/div>',i=i+'<div class="dvoff"><span class="pikdrp"><label>Drop-off<\/label><input id="xdropoffPlaceCity'+r+'" name="xdropoffPlaceCity'+r+'" type="text" value="Airport"/><\/span><span class="when"><label>When<\/label><select id="xdropoffDayCity'+r+'" name="xdropoffDayCity'+r+'"><option value="F">First Day<\/option><option value="L">Last Day<\/option><\/select><\/span><span class="where"><label>Where<\/label><select id="xdropoffCity'+r+'" name="xdropoffCity'+r+'">',u.CarDropOff.DOCity.DOPlaceNo!==undefined?(u.Ranking===1&&(e=u.CarDropOff.DOCity.DOPlaceNo,f=r),i=i+'<option value="'+u.CarDropOff.DOCity.DOPlaceNo+'">'+decodeURIComponent(u.CarDropOff.DOCity.DOPlaceName)+"<\/option>"):(y=u.CarDropOff.DOCity,u.Ranking===1&&(e=y[0].DOPlaceNo,f=r),$.each(y,function(){i=i+'<option value="'+this.DOPlaceNo+'">'+decodeURIComponent(this.DOPlaceName)+"<\/option>"})),i=i+'<\/select><\/span><br style="clear:both"/><\/div>',i=i+"<\/div>"),i=i+"<\/span>");i=i+'<div class="'+s+'" id="spTransRankS'+Number(v+1)+'" data-type="W" data-field="W" data-ovrnts="0"><font class="spSlegend">Transfer to '+h[1]+'<\/font> <img src="https://pictures.tripmasters.com/siteassets/m/self_icon.gif" align="absmiddle"/><span class="spMtransp">&#10095;<\/span>';i=i+"<\/div>";i=i+'<br style="clear:both"/><\/div>'}i=i+"<\/div>s"}this.No==="E"&&(w=Number(t.length-1),p=t[w].split("@"),i=i+'<div id="cityTo'+this.No+'" class="dvMto form-row col-12 pl-0 pr-0 border-primary border-bottom mt-2 pb-2"><span class="S"><font>&#9632;<\/font> Must depart from <b>'+this.PlaceName+'<\/b><\/span><input type="hidden" id="xNOCity'+this.No+'" name="xNOCity'+this.No+'" value="'+this.No+'" /><input name="xNACity'+this.No+'" type="hidden" id="xNACity'+this.No+'" value="'+this.PlaceName+'"/><input type="hidden" name="xIDCity'+this.No+'"  id="xIDCity'+this.No+'" value="'+this.PlaceID+'"  /><input name="xCOCitx'+this.No+'" type="hidden" id="xCOCitx'+this.No+'" value="'+p[3].trim()+'"/><input name="xAPICity'+this.No+'" type="hidden" id="xAPICity'+this.No+'" value="'+p[4].replace(/\%\7C/g,"|").trim()+'"/><input type="hidden" id="xSTCity'+this.No+'" name="xSTCity'+this.No+'" value="0"/>','<input type="hidden" id="xOVNCity'+this.No+'" name="xOVNCity'+this.No+'" value="0"/>',"<\/div>")}else{for(c=t[Number(this.No-1)].split("@"),i=i+'<div id="cityTo'+this.No+'" class="dvMto form-row col-12 pl-0 pr-0 border-primary border-bottom"><div class="form-group col-8"><label>To<\/label><p id="xArrCode'+this.No+'" class="parrcode d-block mb-2">'+c[3].trim()+'<\/p><p id="xArrCity'+this.No+'" class="parrcity d-block">'+c[1]+'<\/p><input type="hidden" id="xNOCity'+this.No+'" name="xNOCity'+this.No+'" value="'+this.No+'" /><input name="xNACity'+this.No+'" type="hidden" id="xNACity'+this.No+'" value="'+c[1]+'"/><input type="hidden" name="xIDCity'+this.No+'"  id="xIDCity'+this.No+'" value="'+c[2]+'"  /><input name="xCOCitx'+this.No+'" type="hidden" id="xCOCitx'+this.No+'" value="'+c[3].trim()+'"/><input name="xAPICity'+this.No+'" type="hidden" id="xAPICity'+this.No+'" value="'+c[4].replace(/\%\7C/g,"|").trim()+'"/><\/div><div class="form-group col-4"><label class="mb-2">Number of nights<\/label><select class="form-control border-bottom border-left-0 border-right-0 border-top-0 pl-0" name="xSTCity'+this.No+'" id="xSTCity'+this.No+'">',n=1;n<=14;n++)k=n===1?"night":"nights",b=n===Number(c[5])?"selected":"",i=i+'<option value="'+n+'" '+b+" >"+n+" "+k+"<\/option>";i=i+'<\/select><button class="close position-relative nxtX" id="xspClose" type="button" aria-label="Close"><span aria-hidden="true">&times;<\/span><\/button><\/div>';s="spTransActive";a=1;this.Options!==null?(r=this.No,d=this.Options,i=i+'<div class="dvMtravelto" id="dvMtravelTo'+r+'" >',this.Options[0].Ranking!==null?$.each(d,function(){if(this.Ranking===1?(i=i+'<input name="xFIELDCity'+r+'" type="hidden" id="xFIELDCity'+r+'" value="'+this.ProductFreeField1+'"/>',i=i+'<input name="xTRANSCity'+r+'" type="hidden" id="xTRANSCity'+r+'" value="'+this.ProductType+'"/>',i=i+'<input type="hidden" id="xOVNCity'+r+'" name="xOVNCity'+r+'" value="'+this.Overnight+'"/>',i=i+'<div class="spTransActive" id="spTransRank'+r+this.Ranking+'" data-type="'+this.ProductType+'" data-field="'+this.ProductFreeField1+'" data-ovrnts="'+this.Overnight+'"><font class="spSlegend">Travel by<\/font>  <img src="https://pictures.tripmasters.com/siteassets/m/'+this.ProductTypeName.replace(/\s/g,"_").toLowerCase()+'_icon.gif" align="absmiddle"/> <span class="spMtranspR">&#10095;<\/span>',this.Overnight===1?i=i+"&nbsp;&nbsp;  Overnight train":"",i=i+"<\/div>",s="spTransNoActive"):(i=i+'<div class="spTransNoActive" id="spTransRank'+r+this.Ranking+'" data-type="'+this.ProductType+'" data-field="'+this.ProductFreeField1+'" data-ovrnts="'+this.Overnight+'"><font class="spSlegend">Travel by<\/font>  <img src="https://pictures.tripmasters.com/siteassets/m/'+this.ProductTypeName.replace(/\s/g,"_").toLowerCase()+'_icon.gif" align="absmiddle"/> <span class="spMtranspR">&#10095;<\/span>',this.Overnight===1?i=i+"&nbsp;&nbsp;  Overnight train":"",i=i+"<\/div>",a++),this.ProductType==="C"){if(l="none",this.Ranking===1?l="block":"",i=i+'<br style="clear:both"/><div id="dvCarOpt'+r+'" class="dvCarOpt" style="display:'+l+'">',i=i+'<div><span class="pikdrp"><label>Pick-up<\/label><input id="xpickupPlaceCity'+r+'" name="xpickupPlaceCity'+r+'"  type="text" value="Airport"/><\/span><span class="when"><label>When<\/label><select id="xpickupDayCity'+r+'" name="xpickupDayCity'+r+'"><option value="F">First Day<\/option><option value"L">Last Day<\/option><\/select><\/span><br style="clear:both"/><\/div>',i=i+'<div class="dvoff"><span class="pikdrp"><label>Drop-off<\/label><input id="xdropoffPlaceCity'+r+'" name="xdropoffPlaceCity'+r+'" type="text" value="Airport"/><\/span><span class="when"><label>When<\/label><select id="xdropoffDayCity'+r+'" name="xdropoffDayCity'+r+'"><option value="F">First Day<\/option><option value="L">Last Day<\/option><\/select><\/span><span class="where"><label>Where<\/label><select id="xdropoffCity'+r+'" name="xdropoffCity'+r+'" date-seq="'+r+'">',this.CarDropOff!==null){var n=this.CarDropOff.DOCity;$.each(n,function(){this.Ranking===1&&(e=this.DOPlaceNo,f=r);i=i+'<option value="'+this.DOPlaceNo+'">'+decodeURIComponent(this.DOPlaceName)+"<\/option>"})}else n=this.CarDropOff.DOCity,this.Ranking===1&&(e=n[0].DOPlaceNo,f=r),$.each(n,function(){i=i+'<option value="'+this.DOPlaceNo+'">'+decodeURIComponent(this.DOPlaceName)+"<\/option>"});i=i+'<\/select><\/span><br style="clear:both"/><\/div>';i=i+"<\/div>"}}):(a=1,u=this.Options.Option,$.each(u,function(){var n,t;this.ProductType==="C"&&(n="none",this.Ranking===1?n="block":"",i=i+'<div id="dvCarOpt'+r+'" class="dvCarOpt col-12 pl-0 pr-0" style="display:'+n+'">',i=i+'<div class="form-row"><div class="pikdrp form group col-3"><label>Pick-up<\/label><input class="form-control border-bottom border-left-0 border-right-0 border-top-0 pl-0 pr-0" id="xpickupPlaceCity'+r+'" name="xpickupPlaceCity'+r+'"  type="text" value="Airport"/><\/div><div class="when form-group col-4"><label>When<\/label><select class="form-control border-bottom border-left-0 border-right-0 border-top-0 pl-0" id="xpickupDayCity'+r+'" name="xpickupDayCity'+r+'"><option value="F">First Day<\/option><option value"L">Last Day<\/option><\/select><\/div><\/div>',i=i+'<div class="dvoff form-row"><div class="pikdrp form-group col-3"><label>Drop-off<\/label><input class="form-control border-bottom border-left-0 border-right-0 border-top-0 pl-0 pr-0" id="xdropoffPlaceCity'+r+'" name="xdropoffPlaceCity'+r+'" type="text" value="Airport"/><\/div><div class="when form-group col-4"><label>When<\/label><select class="form-control border-bottom border-top-0 border-left-0 border-right-0 pl-0 pr-0" id="xdropoffDayCity'+r+'" name="xdropoffDayCity'+r+'"><option value="F">First Day<\/option><option value="L">Last Day<\/option><\/select><\/div><div class="where form-group col-5"><label>Where<\/label><select class="form-control border-bottom border-top-0 border-left-0 border-right-0 pl-0 pr-0" id="xdropoffCity'+r+'" name="xdropoffCity'+r+'" date-seq="'+r+'">',this.CarDropOff.DOCity.DOPlaceNo!==undefined?i=i+'<option value="'+this.CarDropOff.DOCity.DOPlaceNo+'">'+this.CarDropOff.DOCity.DOPlaceName+"<\/option>":(t=this.CarDropOff.DOCity,$.each(t,function(){i=i+'<option value="'+this.DOPlaceNo+'">'+this.DOPlaceName+"<\/option>"})),i=i+"<\/select><\/div><\/div>",i=i+"<\/div>");this.Ranking===1?(i=i+'<input name="xFIELDCity'+r+'" type="hidden" id="xFIELDCity'+r+'" value="'+this.ProductFreeField1+'"/>',i=i+'<input name="xTRANSCity'+r+'" type="hidden" id="xTRANSCity'+r+'" value="'+this.ProductType+'"/>',i=i+'<input type="hidden" id="xOVNCity'+r+'" name="xOVNCity'+r+'" value="'+this.Overnight+'"/>',i=i+'<div class="spTransActive" id="spTransRank'+r+this.Ranking+'" data-type="'+this.ProductType+'" data-field="'+this.ProductFreeField1+'" data-ovrnts="'+this.Overnight+'"><font class="spSlegend">Travel by<\/font>  <img src="https://pictures.tripmasters.com/siteassets/m/'+this.ProductTypeName.replace(/\s/g,"_").toLowerCase()+'_icon.gif" align="absmiddle"/> <span class="spMtranspR">&#10095;<\/span>',this.Overnight==="1"?i=i+"&nbsp;&nbsp;  Overnight train":"",i=i+"<\/div>",s="spTransNoActive"):(i=i+'<div class="spTransNoActive" id="spTransRank'+r+this.Ranking+'" data-type="'+this.ProductType+'" data-field="'+this.ProductFreeField1+'" data-ovrnts="'+this.Overnight+'"><font class="spSlegend">Travel by<\/font>  <img src="https://pictures.tripmasters.com/siteassets/m/'+this.ProductTypeName.replace(/\s/g,"_").toLowerCase()+'_icon.gif" align="absmiddle"/> <span class="spMtranspR">&#10095;<\/span>',this.Overnight==="1"?i=i+"&nbsp;&nbsp;  Overnight train":"",i=i+"<\/div>",a++)})),i=i+'<div class="'+s+'" id="spTransRank'+r+Number(a+1)+'" data-type="OWN" data-field="W" data-ovrnts="0"><font class="spSlegend">Travel by<\/font> <img src="https://pictures.tripmasters.com/siteassets/m/self_icon.gif" align="absmiddle"/><span class="spMtransp">&#10095;<\/span><\/span>',i=i+"<\/div>",i=i+'<br style="clear:both"/>',i=i+"<\/div>"):this.No<o&&(r=this.No,s="spTransActive",i=i+'<div class="dvMtravelto" id="dvMtravelTo'+r+'" >',i=i+'<input name="xFIELDCity'+r+'" type="hidden" id="xFIELDCity'+r+'" value="OWN"/>',i=i+'<input name="xTRANSCity'+r+'" type="hidden" id="xTRANSCity'+r+'" value="W"/>',i=i+'<input type="hidden" id="xOVNCity'+r+'" name="xOVNCity'+r+'" value="0"/>',i=i+'<div class="'+s+'" id="spTransRank'+r+'1" data-type="OWN" data-field="W" data-ovrnts="0"><font class="spSlegend">Travel by<\/font> <img src="https://pictures.tripmasters.com/siteassets/m/self_icon.gif" align="absmiddle"/><span class="spMtransp">&#10095;<\/span><\/div>',i=i+'<br style="clear:both"/>',i=i+"<\/div>");i=i+'<\/div><\/br style="clear:both">'}});$(i).insertAfter(".dvMBYOfrom");$(".nxtX").click(function(){startagain()});$('div[id^="spTransRank"]').click(function(){modifyTranspOption(this)});$('select[id^="xdropoffCity"]').change(function(){modifyDropCarCty(this)});i="";$("#tranWait").remove();$(".dvMPaxRoom").show();$(".btnMcont").removeAttr("disabled")}function startAgain(){$("#dvTrasOptModal").modal("toggle");$(".dvMPaxRoom").hide();$("#dvTransportR").html("").html('<div class="loader"><\/div>')}function doAjaxOnReady(){$.ajax({type:"Get",url:SiteName+"/api/Packages/DepCity",contentType:"application/json; charset=utf-8",dataType:"json",success:function(n){var t=n;depCities=$.map(t,function(n){return{label:n.plC_Title+" - "+n.plC_Code,value:n.plC_Title,id:n.plcid,code:n.plC_Code}});setautocomplete("qLeaveNA","dep")},error:function(n){alert(n.responseText+" = Error")}});$.ajax({type:"Get",url:SiteName+"/Api/Packages/PriorCity",contentType:"application/json; charset=utf-8",dataType:"json",success:function(n){var t=n;arrivalCities=$.map(t,function(n){return{label:n.ctyNA+" ("+n.couNA+")  - "+n.ctyCOD,value:n.ctyNA+" ("+n.couNA+")",id:n.ctyID,code:n.ctyCOD,dept:n.deptNA,hotapi:n.hotelAPI}});setautocomplete("qNACity1","arr");cookieCheck()},error:function(n){alert(n.responseText+" = Error")}})}function cookieCheck(){backCookie=Cookies.get("backCookMhome");backCookie!=undefined?(haveCook=1,buildFromCook(1)):/Design/.test(window.location)==!0?$(".pMtab").trigger("click"):""}function buildFromCook(){var n,t,i;$("#dvMbyoContainer").collapse("toggle");n=JSON.parse(Cookies.get("backCookMhome"));$("#qWair").val(n.qWair);$("#qDepCity").html(n.qLeaveNA);$("#qLeaveNA").val(n.qLeaveNA);$(".pdepcode, .pdepcity, .pdepnocode").slideDown("fast");$("#qLeaveID").val(n.qLeaveID);$("#qLeaveCO").val(n.qLeaveCO);$("#qDepCode").html(n.qLeaveCO);$("#qsRetCity").val(n.qsRetCity);$("#goingID, #xgoingID, #goingDep").val(n.goingID);t=0;i=Object.keys(n).length;jQuery.each(JSON.parse(Cookies.get("backCookMhome")),function(n,r){/qNACity/.test(n)===!0?(n.match(isNumber)>1?$(".pMaddcity").trigger("click"):"",$("#"+n+"").val(r),$("#qArrCity"+n.match(isNumber)+"").html(r).slideDown("fast")):"";/qIDCity/.test(n)===!0?$("#"+n+"").val(r):"";/qCOCity/.test(n)===!0?($("#"+n+"").val(r),$("#qArrCode"+n.match(isNumber)+"").html(r).slideDown("fast"),$("#qArrNoCode"+n.match(isNumber)+"").slideDown("fast")):"";/qAPICity/.test(n)===!0?$("#"+n+"").val(r):"";/qLeave/.test(n)===!0?$("#"+n+"").val(r):"";/qSTCity|qArrDate/.test(n)===!0?$("#"+n+"").val(r).addClass("mt-4"):"";$("#spClose"+n.match(isNumber)+"").show();t+=1;t===i?(Cookies.set("backCookMhome","",{expires:-1}),$(".X").click(function(){deletecity(Number(this.id.match(isNumber)))})):""})}function setautocomplete(n,t){switch(t){case"dep":$("#"+n+"").autocomplete({autoFocus:!0,source:depCities,minLength:3,response:function(n,t){if(t.content.length===0)return alert("No valid airport found"),!1},select:function(n,t){return $("#qLeaveID").val(t.item.id),$("#qLeaveCO").val(t.item.code),$("#qsRetCity").val(t.item.id),$("#qDepCode").html(t.item.code),$("#qDepCity").html(t.item.value),$("#qLeaveNA").val(t.item.value).addClass("inputSelectText"),$("#qArrDate").addClass("mt-4"),$(".pdepcode, .pdepcity, .pdepnocode").slideDown("fast"),!1}}).click(function(){$("#qLeaveNA").val("").select().removeClass("border-warning")}).data("ui-autocomplete")._renderItem=function(n,t){var i=$("<span><\/span>").text(t.label);return highlightText(this.term,i),$("<li><\/li>").append(i).appendTo(n)};break;case"arr":$("#"+n+"").autocomplete({autoFocus:!0,source:function(n,t){var i;n.term.length<4?i=new RegExp("^"+$.ui.autocomplete.escapeRegex(n.term),"i"):n.term.length>=4&&(i=new RegExp("\\b"+$.ui.autocomplete.escapeRegex(n.term),"i"));t($.map(arrivalCities,function(n){if(i.test(n.value)||i.test(n.code))return n}))},minLength:3,response:function(t,i){if(i.content.length===0&&$("#"+t.target.id+"").val().length>=5)return $("#"+n.replace("NA","ID")+"").val("-1"),i.content.push({label:"No result found",value:""}),!1},select:function(t,i){var r=n.match(isNumber);return Number(r)===1&&($("#goingID, #xgoingID, #goingDep").val(i.item.dept),$("#spClose1").show()),$("#"+n+"").val(i.item.value).addClass("inputSelectText"),$("#"+n.replace("NA","ID")+"").val(i.item.id),$("#"+n.replace("NA","CO")+"").val(i.item.code),$("#"+n.replace("NA","API")+"").val(i.item.hotapi),$("#qArrCode"+r+"").html(i.item.code).slideDown("fast"),$("#qArrCity"+r+"").html(i.item.value).slideDown("fast"),$("#qArrNoCode"+r+"").slideDown("fast"),$("#qSTCity"+r+"").addClass("mt-4"),$("#spClose"+r+"").show(),!1},close:function(n){var i=$("#"+n.target.id+"").val();if($("#"+n.target.id+"").val().length>=3&&$("#"+n.target.id.replace("NA","ID")+"").val()=="-1"){var r=$(this).data("ui-autocomplete").menu.element[0].children[0],u=$(".ui-autocomplete"),f=u.val(),t=$(r).text();$("#"+this.id+"").val(t.substring(0,t.indexOf("-")));t=="No result found"?($("#"+n.target.id.replace("NA","ID")+"").val("-1"),$("#"+n.target.id+"").val(i)):$.map(arrivalCities,function(i){$.each(i.label,function(){if(i.label==t){$("#"+n.target.id.replace("NA","ID")+"").val(i.id);$("#"+n.target.id.replace("NA","CO")+"").val(i.code);$("#"+n.target.id.replace("NA","API")+"").val(i.hotapi);var r=n.target.id.match(isNumber);Number(r)===1&&$("#qgoingID, #xgoingID").val(i.dept)}})})}}}).click(function(){$("#"+n+"").select().removeClass("border-warnings");$("#"+n+"").val()=="City name"&&$("#"+n+"").val("");$("#"+n.replace("NA","ID")+"").val("-1")}).data("ui-autocomplete")._renderItem=function(n,t){var i=$("<span><\/span>").text(t.label);return highlightText(this.term,i),$("<li><\/li>").append(i).appendTo(n)}}}function addnewcity(n){var u=n.lang.split(","),s=u[0],t=u[1],o,c;if(t>12)return alert("For best results, no more than 12 cities is allowed. Thank."),!1;var h=Number(t)+Number(1),r='<div class="form-row dvMto" id="cityTo'+t+'"><div class="form-group col-8 mb-0"><label for="qAPICity'+t+'">To<\/label><p id="qArrCode'+t+'" class="parrcode mb-0"><\/p><input name="qNACity'+t+'" type="text" class="form-control border-left-0 border-right-0 border-top-0 pl-0" id="qNACity'+t+'" value="City name" /><input type="hidden" name="qIDCity'+t+'" id="qIDCity'+t+'" value="-1" /><input type="hidden" name="qCOCity'+t+'" id="qCOCity'+t+'" value="" /><input type="hidden" name="qAPICity'+t+'" id="qAPICity'+t+'" value="" /><\/div><div class="form-group col-4 mb-0"><label>Number of nights<\/label><select id="qSTCity'+t+'" name="qSTCity'+t+'" class="form-control border-top-0 border-right-0 border-left-0 font-weight-bold pl-0">',f="night",e="";for(i=1;i<15;i++)i>1?f="nights":"",e=i===3?"selected":"",r=r+"<option value="+i+" "+e+">"+i+" "+f+"<\/option>";r=r+'<\/select><button class="close position-relative btnClose" id="spClose'+t+'" type="button" aria-label="Close"><span aria-hidden="true">&times;<\/span><\/button><\/div>';o=$("#cityTo"+s);$(r).insertAfter(o);setautocomplete("qNACity"+t+"","arr");$(".pMaddcity").attr("lang",t+","+h);$(".parrcode, .parrcity").click(function(){updatearrcity(this)});c=$("#cityTo"+t).position();$("#spClose"+t+"").show().click(function(){deletecity(Number(t))})}function deletecity(n){var f,r,t,u;if(n===1)$("#qNACity1").val("City name").slideDown("fast"),$("#qIDCity1").val(-1),$("#qCOCity1").val(""),$("#qAPICity1").val(""),$("#qArrCode1, #qArrCity1, #qArrNoCode1").slideUp("fast").html(""),$("#spClose1").hide();else{if(f=n+1,r=$('div[id^="cityTo"]').length,$("#cityTo"+n+"").remove(),t=0,u=0,f>r)t=r-1,u=r;else for(i=f;i<=r;i++)$("#cityTo"+i+"").length>0&&(t=i-1,$("#cityTo"+i+"").attr("id","cityTo"+t+""),$("#qArrCode"+i+"").attr("id","qArrCode"+t+""),$("#qArrCity"+i+"").attr("id","qArrCity"+t+""),$("#qNACity"+i+"").attr("name","qNACity"+t+""),$("#qNACity"+i+"").attr("id","qNACity"+t+""),$("#qIDCity"+i+"").attr("name","qIDCity"+t+""),$("#qIDCity"+i+"").attr("id","qIDCity"+t+""),$("#qCOCity"+i+"").attr("name","qCOCity"+t+""),$("#qCOCity"+i+"").attr("id","qCOCity"+t+""),$("#qAPICity"+i+"").attr("name","qAPICity"+t+""),$("#qAPICity"+i+"").attr("id","qAPICity"+t+""),$("#qArrNoCode"+i+"").attr("id","qArrNoCode"+t+""),$("#spClose"+i+"").attr("id","spClose"+t+""),$("#qSTCity"+i+"").attr("name","qSTCity"+t+""),$("#qSTCity"+i+"").attr("id","qSTCity"+t+""),$("#spClose"+i+"").attr("id","spClose"+t+""),$("#spClose"+t+"").show().click(function(){deletecity(Number(t))}),setautocomplete("qNACity"+t+"","arr"),u=i);return $(".pMaddcity").attr("lang",Number(t)+","+Number(u)),!1}}function highlightText(n,t){for(var f=$.trim(n).toLowerCase(),i=t.get(0).firstChild,e,u,r;(e=i.data.toLowerCase().indexOf(f))>=0;)u=i.splitText(e),i=u.splitText(f.length),r=document.createElement("span"),r.className="highlight boldText",i.parentNode.insertBefore(r,i),r.appendChild(u)}function updatedepairport(){$(".pdepcode, .pdepcity").slideUp("fast").html("");$(".pdepnocode").slideUp("fast");$("#qLeaveNA").css({"font-size":"12px",height:"20px"}).slideDown("fast").trigger("click");$("#qLeaveID").val("-1");$("#qsRetCity").val("-1")}function updatearrcity(n){var t=n.id.match(isNumber);$("#qArrCode"+t+", #qArrCity"+t+"").slideUp("fast").html("");$("#qArrNoCode"+t+"").slideUp("fast");$("#qNACity"+t+"").slideDown("fast").trigger("click");$("#qIDCity"+t+"").val("-1");$("#qCOCity"+t+"").val("");$("#qAPICity"+t+"").val("")}function modifyTranspOption(n){var i=n.id.substring(0,n.id.length-1),t=i[i.length-1],r=Number(n.id.substring(n.id.length-1,n.id.length))+1,u=$('div[id^="'+i+'"]').length,f;r>u?r=1:"";i=i+r;u>1?($("#"+n.id+"").hide("slide",{direction:"up"},"fast").removeClass("spTransActive").addClass("spTransNoActive"),$("#"+i+"").show("slide",{direction:"up"},"fast").removeClass("spTransNoActive").addClass("spTransActive"),$("#xFIELDCity"+t+"").val($("#"+i+"").data("field")),$("#xTRANSCity"+t+"").val($("#"+i+"").data("type")),$("#xOVNCity"+t+"").val($("#"+i+"").data("ovrnts")),/car/.test($("#"+i+"").find("img").attr("src"))===!0?($("#dvCarOpt"+t+"").slideDown("slow"),t==="S"?$("#xdropoffCityS option:first-child").attr("selected","selected").trigger("change"):($("#xdropoffCity"+t+" option:first-child").attr("selected","selected"),modifyDropCarCtyLast(t,$("#xdropoffCity"+t+"").val()))):$("#dvCarOpt"+t+"").is(":visible")===!0?(f=$("#xdropoffCity"+t+" option:selected").val(),$("#dvCarOpt"+t+"").slideUp("slow"),checkCarSelected(f,t),$("#xdropoffCity"+t+" option:selected").removeAttr("selected")):""):alert("Only this option.")}function checkCarSelected(n,t){var i,r;i=t==="S"?0:t;r=n;$(".dvMtravelto").each(function(){var n=this.id[this.id.length-1];n>i?($("#"+this.id+"").show(),$("#xFIELDCity"+n+"").val($("#"+this.id+"").show().find("span:visible").data("field"))):""})}function modifyDropCarCty(n){var i=n.id[n.id.length-1],t=$("#"+n.id+"").find("option:selected").val();$(".dvMtravelto").each(function(){var n=this.id[this.id.length-1];i===n?"":t!="E"?(n<t?($("#"+this.id+"").hide(),$("#xFIELDCity"+n+"").val("")):"",n>=t?($("#"+this.id+"").show(),$("#xFIELDCity"+n+"").val($("#"+this.id+"").show().find("span:visible").data("field"))):""):($("#"+this.id+"").hide(),$("#xFIELDCity"+n+"").val(""))})}function modifyDropCarCtyLast(n,t){var i=n,r=t;$(".dvMtravelto").each(function(){var n=this.id[this.id.length-1];n>i?n<r?($("#"+this.id+"").hide(),$("#xFIELDCity"+n+"").val("")):"":""})}function changeCabin(n){$(".pMdialogCabin").each(function(){this.id===n.id?($("#"+n.id+"").find("span:first").html("&#10003;"),$("#Cabin, #xCabin").val(n.id)):$("#"+this.id+"").find("span:first").html("&nbsp;")})}function checkTotalPax(){var n=Number($("#xiAdults").val())+Number($("#xRoom2_iAdults").val())+Number($("#xRoom3_iAdults").val()),t=Number($("#xiChildren").val())+Number($("#xRoom2_iChildren").val())+Number($("#xRoom3_iChildren").val());return totalPax=n+t,totalPax<=6?!0:(alert("Max guest allowed (adults + children) are 6 !"),!1)}function adultPlus(n){var t,i;n.id.match(isNumber)===null?(t=$("#xiAdults"),i=Number(t.val()),i<=6?($(t).val(i+1),checkTotalPax()===!0?"":$(t).val(i)):""):(t=$("#xRoom"+n.id.match(isNumber)+"_iAdults"),i=Number(t.val()),i<=6?($(t).val(i+1),checkTotalPax()===!0?"":$(t).val(i)):"")}function adultMinus(n){var t;n.id.match(isNumber)===null?(t=$("#xiAdults"),nwObjVal=Number(t.val()),nwObjVal>1?t.val(nwObjVal-1):(alert("At least one adult should be present at room 1!"),t.val("1"))):(t=$("#xRoom"+n.id.match(isNumber)+"_iAdults"),nwObjVal=Number(t.val()),nwObjVal>1?t.val(nwObjVal-1):(alert("At least one adult should be present at room "+n.id.match(isNumber)+"!"),t.val("1")))}function childPlus(n){var t;n.id.match(isNumber)===null?(t=$("#xiChildren"),t.val()===""||t.val()==="0"?(t.val("1"),checkTotalPax()===!0?childAgeChange(t):t.val("0")):t.val()==="1"?(t.val("2"),checkTotalPax()===!0?childAgeChange(t):t.val("1")):t.val()==="2"?alert("Sorry, only 2 Children per room"):""):(t=$("#xRoom"+n.id.match(isNumber)+"_iChildren"),t.val()===""||t.val()==="0"?(t.val("1"),checkTotalPax()===!0?childAgeChange(t):t.val("0")):t.val()==="1"?(t.val("2"),checkTotalPax()===!0?childAgeChange(t):t.val("1")):t.val()==="2"?alert("Sorry, only 2 Children per room"):"")}function childMinus(n){var t;n.id.match(isNumber)===null?(t=$("#xiChildren"),t.val()==="2"?(t.val("1"),childAgeChange(t)):t.val()==="1"?(t.val("0"),childAgeChange(t)):""):(t=$("#xRoom"+n.id.match(isNumber)+"_iChildren"),t.val()==="2"?(t.val("1"),childAgeChange(t)):t.val()==="1"?(t.val("0"),childAgeChange(t)):"")}function childAgeChange(n){$(n).attr("id").match(isNumber)===null?$('#dvroom1 p[id^="pAge"]').each(function(t,i){i.id.match(isNumber)<=n.val()?($(this).show(),$("#xiChild"+this.id.match(isNumber)+"").val("Child "+this.id.match(isNumber)+" Age")):($(this).hide(),$("#xiChild"+this.id.match(isNumber)+"").val(""))}):$("#dvroom"+$(n).attr("id").match(isNumber)+' p[id^="pAge"]').each(function(t,i){i.id.match(isNumber)<=n.val()?($(this).show(),$("#xRoom"+$(n).attr("id").match(isNumber)+"_iChild"+this.id.match(isNumber)+"").val("Child "+this.id.match(isNumber)+" Age")):($(this).hide(),$("#xRoom"+$(n).attr("id").match(isNumber)+"_iChild"+this.id.match(isNumber)+"").val(""))})}function roomTravelers(n){$("#xiRoomsAndPax").val(n.id);$("#roomPaxTxt").html(n.innerHTML);openPaxRoomlist();/Other/.test(n.id)?openRooms(n.id.match(isNumber),0):openRooms(n.id.substring(0,1),n.id.substring(2,3))}function openRooms(n,t){t===0?($("#dvpxperroom").slideDown("slow"),$('div[id^="dvroom"]').each(function(){this.id.match(isNumber)<=n?$(this).slideDown("slow"):($(this).slideUp("slow"),cleanRooms(this))})):($("#dvpxperroom").slideUp("slow"),$('div[id^="dvroom"]').each(function(){this.id.match(isNumber)>1?cleanRooms(this):firstRoom(n,t)}))}function openPaxRoomlist(){$("#dvpxroomlst").is(":visible")===!1?($("#dvpxroomlst").slideDown("slow"),$("#dvpaxRoom").switchClass("dvMdialogRoom","dvMdialogRoomROT")):($("#dvpxroomlst").slideUp("slow"),$("#dvpaxRoom").switchClass("dvMdialogRoomROT","dvMdialogRoom"))}function firstRoom(n,t){$("#xiAdults").val(t);$("#xiChildren").val("");$("#xiChild1").val("");$("#xiChild2").val("");$('#dvroom1 p[id^="pAge"]').each(function(){$(this).hide()})}function cleanRooms(n){$("#"+n.id+"").find("input").each(function(n,t){switch(n){case 0:$("#"+t.id+"").val("");break;case 1:$("#"+t.id+"").val("");break;case 2:$("#"+t.id+"").val("");break;case 3:$("#"+t.id+"").val("")}});$("#"+n.id+' p[id^="pAge"]').each(function(){$(this).hide()})}function showdialog(){$(".dvMMask").show();$(".dvMPageContainer").show("fade");window.scrollTo(0,0);var n=$("#xwCabin").val();n==="No"?$("#dvSelectCabin").hide():$("#dvSelectCabin").show();haveCook===1?($('#dvpxroomlst li[id="'+$("#iRoomsAndPax").val()+'"]').trigger("click"),$("#dvpxroomlst").hide(),$('div p[id^="pAge"] select').each(function(){this.value>0?$(this).parent("p").show():""}),$('.pMdialogCabin[id="'+$("#Cabin").val()+'"]').trigger("click")):"";$(".pMdialogCabin").click(function(){changeCabin(this)})}function hidedialog(){var n=Number($('div[id^="dvroom"]:visible').length);$('div[id^="dvroom"]').each(function(){if($(this).is(":visible")===!0){var i=0,t=this.id.match(isNumber),r=!0,u=!0;if(i=t==1?$(".inpAdult").val():$("#xRoom"+t+"_iAdults").val(),i==""||i==0?r=t==null?errorAlert("xiAdults","Should be at least 1 adult in Room 1"):errorAlert("xRoom"+t+"_iAdults","Should be at least 1 adult in Room"+t):"",r==!1)return!1;$("#"+this.id+' p[id^="pAge"] select').each(function(){if($(this).is(":visible")==!0){var i=$(this).val();i==""||i==null||i==0?(u=errorAlert(this.id,"Room"+t+": Child age is missing"),n++):$("#"+this.id+"").removeClass("errorClass")}})}if(!u)return!1;n--});n===0?hidedialogCont():""}function errorAlert(n,t){var i=$("#"+n+"").position();return $("#"+n+"").addClass("errorClass"),/qNACity/.test(n)?$("#"+n+"").val(t):alert(t),window.scroll(0,i.top-100),!1}function hidedialogCont(){var t="",u,n,r,f,i,e,o;switch($("#xCabin").val()){case"Y":t=", Economy";break;case"W":t=", Premium Economy";break;case"C":t=", Business";break;case"F":t=", First Class"}$("#xwCabin").val()==="No"?t="":"";u=$("#xiRoomsAndPax").val();n=u.substring(0,1);$("#xiRoom").val(n);$("#xRooms").val(n);n=n>1?n+" Rooms":n+" Room";r=u.split("|");i=0;f=/-/.test(r[1])?r[1].split("-"):r[1];for(p in f)i+=Number(f[p]);isNaN(i)?checkTotalPax()===!0?i=Number(totalPax):"":"";haveCook=0;e=n+", "+i+" Travelers"+t;$("#xcabinRoomPax").val(e);$(".dvMPageContainer").hide();$(".dvMMask").hide();o=$(".dvMPaxRoom").position();window.scrollTo(0,o.top-10)}function submitCompList(){var i,t=$("#frmTransp").serializeObject(),n=$("#frmTransp").serialize();delete t.__RequestVerificationToken;n=n.substr(0,n.indexOf("&__RequestVerificationToken"));console.log(t);console.log(n);$.ajax({type:"POST",url:SiteName+"/Api/Packages/webservComponentList",contentType:"application/json",dataType:"json",data:JSON.stringify(n),success:function(n){i=n;submitToBP(t,i)},error:function(n){alert(n.responseText+" = Error webservGetComponentList")}})}function submitToBP(n,t){var r=t.split("@|@"),e=$("#formToBooking"),o="xIDcity"+r[11],u="",f;if(r[1]==="1")for(e.find("input").each(function(){/SystemID/.test(this.id)?this.value=r[2]:"";/PackageComponentList/.test(this.id)?this.value=r[0]:"";/ByStayNite/.test(this.id)?this.value=r[3]:"";/GetNextDay/.test(this.id)?this.value=r[4]:"";/AirVendorAPI/.test(this.id)?this.value=r[5]:"";/AirP2PVendorAPI/.test(this.id)?this.value=r[6]:"";/CarVendorAPI/.test(this.id)?this.value=r[7]:"";/SSVendorAPI/.test(this.id)?this.value=r[8]:"";/TransferVendorAPI/.test(this.id)?this.value=r[9]:"";/TICVendorAPI/.test(this.id)?this.value=r[10]:"";/GIVendorAPI/.test(this.id)?this.value=r[13]:"";/addFlight/.test(this.id)?this.value=n.xaddFlight:"";/Cabin/.test(this.id)?this.value=n.xCabin:"";/iDepCity|iRetCity/.test(this.id)?this.value=n.xidLeavingFrom:"";/StayCityS/.test(this.id)?this.value=n.xNOCityS?n.xIDCityS:n.xIDCity1:"";/StayCityS_Name/.test(this.id)?this.value=n.xNOCityS?decodeURIComponent(n.xNACityS.replace(/\+/g," ").trim()):n.xNACity1.slice(0,n.xNACity1.indexOf("(")).replace(/\+/g," ").trim():"";/StayCityE/.test(this.id)?this.value=n.xNoCityE?n.xIDcityE:n["xIDCity"+r[11]]:"";/StayCityE_Name/.test(this.id)?this.value=n.xNoCityE?decodeURIComponent(n.xNAcityE.replace(/\+/g," ").trim()):n["xNACity"+r[11]].replace(/\+/g," ").trim():"";/Rooms/.test(this.id)?(this.value=n.xRooms,$("#xRooms").val("1")):"";/iRoom/.test(this.id)?(this.value=n.xiRoom,$("#xiRooms").val("1")):"";/iRoomsAndPax/.test(this.id)?(this.value=decodeURI(n.xiRoomsAndPax),$("#xcabinRoomPax").val("1 Room, 2 Travelers, Economy"),$("#xiRoomsAndPax").val("1|2")):"";/iAdults/.test(this.id)?/Room/.test(this.id)?"":(this.value=n.xiAdults,$("xiAdults").val("2")):"";/iChildren/.test(this.id)?/Room/.test(this.id)?"":(this.value=n.xiChildren,$("xiChildren").val("")):"";/iChild1/.test(this.id)?/Room/.test(this.id)?"":n.xiChild1?(this.value=n.xiChild1,$("xiChild1").val("")):"":"";/iChild2/.test(this.id)?/Room/.test(this.id)?"":n.xiChild2?(this.value=n.xiChild2,$("xiChild2").val("")):"":"";/iChild3/.test(this.id)?/Room/.test(this.id)?"":n.xiChild3?(this.value=n.xiChild3,$("xiChild3").val("")):"":"";/iChild4/.test(this.id)?/Room/.test(this.id)?"":n.xiChild4?(this.value=n.xiChild4,$("xiChild4").val("")):"":"";/Room2_iAdults/.test(this.id)?n.xRoom2_iAdults?(this.value=n.xRoom2_iAdults,$("xRoom2_iAdults").val("")):this.value="":"";/Room2_iChildren/.test(this.id)?n.xRoom2_iChildren?(this.value=n.xRoom2_iChildren,$("xRoom2_iChildren").val("")):this.value="":"";/Room2_iChild1/.test(this.id)?n.xRoom2_iChild1?(this.value=n.xRoom2_iChild1,$("xRoom2_iChild1").val("")):this.value="":"";/Room2_iChild2/.test(this.id)?n.xRoom2_iChild2?(this.value=n.xRoom2_iChild2,$("xRoom2_iChild2").val("")):this.value="":"";/Room2_iChild3/.test(this.id)?n.xRoom2_iChild3?(this.value=n.xRoom2_iChild3,$("xRoom2_iChild3").val("")):this.value="":"";/Room2_iChild4/.test(this.id)?n.xRoom2_iChild4?(this.value=n.xRoom2_iChild4,$("xRoom2_iChild4").val("")):this.value="":"";/Room3_iAdults/.test(this.id)?n.xRoom3_iAdults?(this.value=n.xRoom3_iAdults,$("xRoom3_iAdults").val("")):this.value="":"";/Room3_iChildren/.test(this.id)?n.xRoom3_iChildren?(this.value=n.xRoom3_iChildren,$("xRoom3_iChildren").val("")):this.value="":"";/Room3_iChild1/.test(this.id)?n.xRoom3_iChild1?(this.value=n.xRoom3_iChild1,$("xRoom3_iChild1").val("")):this.value="":"";/Room3_iChild2/.test(this.id)?n.xRoom3_iChild2?(this.value=n.xRoom3_iChild2,$("xRoom3_iChild2").val("")):this.value="":"";/Room3_iChild3/.test(this.id)?n.xRoom3_iChild3?(this.value=n.xRoom3_iChild3,$("xRoom3_iChild3").val("")):this.value="":"";/Room3_iChild4/.test(this.id)?n.xRoom3_iChild4?(this.value=n.xRoom3_iChild4,$("xRoom3_iChild4").val("")):this.value="":""}),i=1;i<=12;i++)n["xIDCity"+i]?(f=0,u=u+'<input type="hidden" id="StayCity'+i+'" name="StayCity'+i+'" value="'+n["xIDCity"+i]+'"/>',u=u+'<input type="hidden" name="StayCity'+i+'_Name" id="StayCity'+i+'_Name" value="'+decodeURIComponent(n["xNACity"+i].slice(0,n["xNACity"+i].indexOf("(")).replace(/\+/g," ").trim())+'" />',i===1?u=u+'<input type="hidden" name="InDate'+i+'" id="InDate'+i+'" value="'+decodeURIComponent(n.xtxtBYArriving)+'" />':"",u=u+'<input type="hidden" name="APICity'+i+'" id="APICity'+i+'" value="'+decodeURIComponent(n["xAPICity"+i])+'"/>',u=u+'<input type="hidden" name="StayNite'+i+'" id="StayNite'+i+'" value="'+n["xSTCity"+i]+'"/>',n["xOVNCity"+i]?f=n["xOVNCity"+i]:"",u=u+'<input type="hidden" name="OverNiteT'+i+'" id="OverNiteT'+i+'" value="'+f+'"/>',$("#formToBooking").append(u),u=""):i=12,i===12?toBPGo():"";else alert("error")}function toBPGo(){document.formToBooking.action="https://reservation.tripmasters.com/Tourpackage4/Itinerary/Create";document.formToBooking.submit()}var depCities=[],arrivalCities=[],today=new Date,isNumber=/[0-9]+/g,visitId,childAge=[],totalPax=0,haveCook=0,chilObj;for(c=2;c<=11;c++)chilObj={label:c,value:c},childAge.push(chilObj);$(document).ready(function(){if(console.log(Cookies.get("ut2")),Cookies.get("ut2")!=undefined){console.log(Cookies.get("ut2"));var n=$(Cookies.get("ut2").split("&")),t=n[0].split("=");visitId=t[1]}$(".pdepcode, .pdepcity").click(function(){updatedepairport(this)});$(".parrcode, .parrcity").click(function(){updatearrcity(this)});$(".pMaddcity").click(function(){addnewcity(this)});$(".btnClose").click(function(){deletecity(Number(this.id.match(isNumber)))});$("#xcabinRoomPax").click(function(){showdialog()});$("#dvpaxRoom").click(function(){openPaxRoomlist()});$("#dvpxroomlst li").click(function(){roomTravelers(this)});$(".dvMDialogDone").click(function(){hidedialog()});$(".btnMcont").click(function(){submitCompList()});$('span[id^="adultPlus"]').click(function(){$('input[id^="xRoom'+Number(this.id.match(isNumber))+'_"').removeClass("errorClass");adultPlus(this)});$('span[id^="adultMinus"]').click(function(){$('input[id^="xRoom'+Number(this.id.match(isNumber))+'_"').removeClass("errorClass");adultMinus(this)});$('span[id^="childrenPlus"]').click(function(){childPlus(this)});$('span[id^="childrenMinus"]').click(function(){childMinus(this)});$('#xiAdults, input[id^="xRoom"], select[id^="xRoom"], select[id^=xiChild]').click(function(){$(this).removeClass("errorClass")});$("#dvMvisitContainer").on("show.bs.collapse",function(){getRecentlyView()});doAjaxOnReady();$("#dvTrasOptModal").on("shown.bs.modal",function(){callTransportation();var n=callTransportation();n===!1&&$("#dvTrasOptModal").modal("hide")});$(".aBtnTab").on("click",function(){$(this).hasClass("aBtnTab")===!0?$(this).removeClass(".aBtnTab").addClass("aBtnTabOpen"):$(this).removeClass(".aBtnTabOpen").addClass("aBtnTab")});datePicker();$(".inpChild").autocomplete({autoFocus:!0,source:childAge,minLength:0,select:function(n,t){return $(this).val(t.item.value).blur(),!1},response:function(n,t){t.content.length===0&&(errorAlert(this.id,"No valid age"),$(this).blur())}}).click(function(){$(this).removeClass("errorClass");$(this).val("");$(this).attr("readonly",!1)}).focus(function(){$(this).keydown();$(this).attr("readonly",!0)}).blur(function(){($(this).val()==="0"||$(this).val()==="1")&&errorAlert(this.id,"No valid age")})});Date.timeBetween=function(n,t){var e=n.getTime(),o=t.getTime(),i=o-e,s,r,u,f;return i=i/1e3,s=Math.floor(i%60),i=i/60,r=Math.floor(i%60),i=i/60,u=Math.floor(i%24),f=Math.floor(i/24),f>0?f===1?f+" day ago":f+" days ago":u>0?u===1?u+" hour ago":u+" hours ago":r>0?r===1?r+" minute ago":r+" minutes ago":"  just visited"};$.fn.serializeObject=function(){var n={},t=this.serializeArray();return $.each(t,function(){n[this.name]?(n[this.name].push||(n[this.name]=[n[this.name]]),n[this.name].push(this.value||"")):n[this.name]=this.value||""}),n};