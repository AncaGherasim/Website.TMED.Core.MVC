function initpoi(){$.ajax({type:"POST",url:SiteName+"/Api/Hotels/POIHotels/",contentType:"application/json; charset=UTF-8",dataType:"json",data:JSON.stringify({Id:plcID}),success:function(n){cityPoi=n;init()},error:function(n){alert(n.responseText)}})}function init(){var n="",f,r,u;jQuery.each(cityPoi,function(){n=n+'<div class="dvChecks">';n=n+'<input type="checkbox" class="css-checkbox poi" id="'+this.poiid+'" value="'+this.poI_Latitude+"|"+this.poI_Longitude+'" />';n=n+'<label for="'+this.poiid+'" name="checkbox65_lbl" class="css-label">';n=n+"<p>"+this.poI_Title+"<\/p><\/label>";n=n+"<\/div>"});$("#dvPoiList").html(n);NAplc=$("#placeNA").val();IDplc=$("#placeID").val();NAcou=$("#countryNA").val();IDcou=$("#countryID").val();f=new google.maps.Geocoder;objHotels=pageHotels;objPoi=cityPoi;var e=0,t=[],i=[];jQuery.each(pageHotels,function(){t.push(Number(this.giphLatitude));i.push(Number(this.giphLongitude));e++});r=(Math.max.apply(Math,t)-Math.min.apply(Math,t))/2+Math.min.apply(Math,t);u=(Math.max.apply(Math,i)-Math.min.apply(Math,i))/2+Math.min.apply(Math,i);delete distLats;distLats=getDistanceFromLatLonInKm(Math.max.apply(Math,t),Math.max.apply(Math,i),Math.min.apply(Math,t),Math.min.apply(Math,i));delete ctyLatLong;ctyLatLong=Number(r)+"|"+Number(u);buildBigMap(0);$("#selZone").change(function(){javaFilter()});$(".rev:checkbox").click(function(){javaFilter()});$("#favorite").click(function(){jsFav=1;javaFilter()});$(".rat:checkbox").click(function(){javaFilter()});$(".poi:checkbox").click(function(){onePoi(this.id)});$("#resetButton").click(function(){$("#selZone").val(0);$(".rat:checkbox").prop("checked",!0);$(".fav:checkbox").prop("checked",!1);$(".rev:checkbox").prop("checked",!0);$(".poi:checkbox").prop("checked",!1);jsFav=0;javaFilter()});$(".aOnly").click(function(){$("#selZone").val(0);this.id.indexOf("chkRevw")>-1?$(".rat:checkbox").prop("checked",!0):$(".rat:checkbox").prop("checked",!1);$(".fav:checkbox").prop("checked",!1);$(".rev:checkbox").prop("checked",!1);jsFav=0;var n=this.id.split("|");return $("#"+n[1]+"").prop("checked",!0),setTimeout(function(){javaFilter()},300),!1});$(".modal__close, #applyButton").click(function(){closeModal()});$("#modalFilter").click(function(){openModalFilter()});$("#dvPoiList").niceScroll({touchbehavior:!1,cursorcolor:"#638bd1",cursoropacitymax:.7,cursorwidth:6,background:"#ccc",autohidemode:!1})}function javaFilter(){var u,n,i,f,t,r,e,o;map=null;objHotels=pageHotels;objPoi=cityPoi;u=$("#selZone").val();u>0?objHotels=$.grep(objHotels,function(n){return n.gipH_TNZoneID==u}):"";n="";i=0;$(".rat:checkbox").each(function(){this.checked?n=i==0?this.value:n+"|"+this.value:"";this.checked?i++:""});f=0;i>0&&(n=n.replace(/\_/g," "),objHotels=$.grep(objHotels,function(t){return new RegExp(n).test(t.gipH_TNTournetRating.replace(/\+/g,"plus"))}));$(".fav:checkbox").each(function(){this.checked?jsFav=1:""});jsFav==1&&(objHotels=$.grep(objHotels,function(n){return n.gipH_TNSequence.between(49,60)}));t="";r=0;$(".rev:checkbox").each(function(){this.checked?t=r==0?this.value:t+"|"+this.value:"";this.checked?r++:""});e=0;r>0&&(o=new RegExp(t),objHotels=grepRev(objHotels,t));objHotels.length==0?noHotel():buildBigMap(1)}function noHotel(){return alert("No Hotels, redifine the filter"),$("#resetButton").trigger("click"),!1}function buildBigMap(n){var c,l,a,v,i,y,t,p;if(map=null,n==0){var f=ctyLatLong.split("|"),e=f[0],o=f[1],s=new google.maps.LatLng(e,o),i=13;if(distLats!="")switch(!0){case distLats<50:i=11;break;case distLats>50&&distLats<150:i=10;break;case distLats>150:i=9}}else{var w=0,h=[],b,k,d,g,r=[],u=[];jQuery.each(objHotels,function(){r.push(Number(this.giphLatitude));u.push(Number(this.giphLongitude));w++});c=(Math.max.apply(Math,r)-Math.min.apply(Math,r))/2+Math.min.apply(Math,r);l=(Math.max.apply(Math,u)-Math.min.apply(Math,u))/2+Math.min.apply(Math,u);delete distLats;distLats=getDistanceFromLatLonInKm(Math.max.apply(Math,r),Math.max.apply(Math,u),Math.min.apply(Math,r),Math.min.apply(Math,u));delete ctyLatLong;ctyLatLong=Number(c)+"|"+Number(l);f=ctyLatLong.split("|");e=f[0];o=f[1];s=new google.maps.LatLng(e,o);a=Math.max.apply(Math,h);v=Math.min.apply(Math,h);jQuery.each([],function(n,t){bPrt=t.split("|");(bPrt[0]=v)&&(b=bPrt[1],d=bPrt[0]);(bPrt[0]=a)&&(k=bPrt[1],g=bPrt[0]);delete bPrt});i=13;switch(!0){case distLats<50:i=11;break;case distLats>50&&distLats<150:i=10;break;case distLats>150:i=9}}y={zoom:i,center:s,mapTypeControl:!0,panControl:!0,zoomControl:!0,scaleControl:!0,streetViewControl:!0,overviewMapControl:!0,rotateControl:!1,mapTypeId:google.maps.MapTypeId.ROADMAP};map=new google.maps.Map(document.getElementById("dvPageMap"),y);t=document.createElement("div");p=new StyleMapControl(t,""+objHotels.length+" Hotels");map.controls[google.maps.ControlPosition.RIGHT_BOTTOM].push(t);t=document.createElement("div");p=new StyleMapControl(t,"Show Activities");t.index=1;map.controls[google.maps.ControlPosition.RIGHT_BOTTOM].push(t);google.maps.event.addDomListener(t,"mouseover",function(){$(this).addClass("dvHover")});google.maps.event.addDomListener(t,"mouseout",function(){$(this).removeClass("dvHover")});google.maps.event.addDomListener(t,"click",function(){$(".poi:checkbox").prop("checked",!0);buildPois()});buildHotel()}function StyleMapControl(n,t){var i=document.createElement("div"),r;i.style.backgroundColor="#fff";i.style.border="1px solid #fff";i.style.borderRadius="5px";i.style.boxShadow="0 2px 6px rgba(0,0,0,.3)";i.style.cursor="pointer";i.style.marginBottom="10px";i.style.marginRight="5px";i.style.textAlign="center";i.title=""+t+"";i.style.width="93px";n.appendChild(i);r=document.createElement("div");r.style.color="#333";r.style.fontFamily="Roboto,Arial,sans-serif";r.style.fontSize="12px";r.style.lineHeight="22px";r.style.paddingLeft="5px";r.style.paddingRight="5px";r.innerHTML=t;i.appendChild(r)}function buildHotel(){var n=0;jQuery.each(objHotels,function(){var o,i,h,t,l;n++;var v=this.giphLatitude,y=this.giphLongitude,s=this.gipH_TNTournetRating.match(isNumber);s===null?s=this.gipH_TNTournetRating:"";o="";i="";switch(!0){case/Stars|Lodge|Cruise/g.test(this.gipH_TNTournetRating):i="Stars_"+this.gipH_TNTournetRating.replace(/\s/g,"_");i.includes("+")&&(i=i.replace("+","_Plus"));break;case!/Stars|Lodge|Cruise/g.test(this.gipH_TNTournetRating):i=this.gipH_TNTournetRating.replace(/\s/g,"_").toLowerCase();i.includes("+")&&(i=i.replace("+","_Plus"))}h=/Stars/g.test(this.gipH_TNTournetRating)?this.gipH_TNTournetRating:"";o='<img src="https://pictures.tripmasters.com/siteassets/d/'+i+'.gif" align="absmiddle" /><span style="display:table-cell">'+h+"<\/span>";var b=new google.maps.Point(25,42),r='<div class="mapBubb">';r=r+o;t='<div class="dvaddHot">';t=t+"<div><b>"+this.pdL_Title+'<\/b><\/div><p style="display: table">'+o+"<\/p>";t=t+'<div class="jsO">';var f="",e="",p=this.ghS_FinalScore,c=expediaNoRange(this.ghS_FinalScore);switch(c){case"EX":f="Excellent";e="EX";break;case"VG":f="Very Good";e="VG";break;case"GD":f="Good";e="GD";break;case"FA":f="Fair";e="FA";break;case"PO":f="Poor";e="PO"}t=t+'<div style="height: 12px;"><span class="sphotelScore"><div><span style="font-weight:700">'+p+"/5 <\/span>"+f+"<\/div>";t=t+'<br style="clear:both" />';r=r+"<div>";this.pdL_SequenceNo>49&&this.pdL_SequenceNo<60&&(r=r+'<span class="spFav">&nbsp;<\/span>');r=r+'<span class="jsS'+c+'">'+this.ghS_FinalScore+'<\/span><br style="clear:both" /><\/div>';t=t+"<\/div>";this.pdL_SequenceNo>49&&this.pdL_SequenceNo<60&&(t=t+'<p class="fF"><\/p>');t=t+'<p id="'+this.pdlid+'" class="mrDet" onclick="bubbleHotelInfo(this.id)")">more details<\/p>';t=t+"<\/div>";r=r+"<\/div>";l=/Stars|Lodge|Cruise/g.test(i)===!1?"https://pictures.tripmasters.com/siteassets/hotelstars/hotel_0star_BG.png":"https://pictures.tripmasters.com/siteassets/hotelstars/hotel_"+s+"stars.png";var u=new google.maps.Marker({position:new google.maps.LatLng(v,y),map:map,icon:l,draggable:!1,raiseOnDrag:!0,zIndex:8998}),a=new google.maps.InfoWindow({content:t}),w=new google.maps.InfoWindow({content:t});google.maps.event.addListener(u,"mouseover",function(){a.open(map,u)});google.maps.event.addListener(u,"mouseout",function(){a.close(map,u)});google.maps.event.addListener(u,"click",function(){w.open(map,u);map.setCenter(u.getPosition())})})}function buildPois(){mapMark=[];poiMarker=[];jQuery.each(objPoi,function(){var t,n,i;poiMarker.push(this.poiid);locLat=this.poI_Latitude;locLong=this.poI_Longitude;iconImg="https://pictures.tripmasters.com/siteassets/d/MapMarker_Ball__Orange_40.gif";t=new google.maps.Marker({position:new google.maps.LatLng(locLat,locLong),map:map,title:this.poI_Title,icon:iconImg});t.id=this.poiid;mapMark.push(t);n='<div style="padding:5px" class="Text_11" align="left">';n=this.poI_PictureURL!="none"?n+'<img src="'+this.poI_PictureURL+'" align="left" style="width:50%; height:50%; margin:0px 5px 5px 0px;"  />':n+'<img src="https://pictures.tripmasters.com/siteassets/d/NoPicture.jpg" align="left" style="margin:0px 5px 5px 0px;"  />';n=n+'<span><b class="Text_12_BlueBold">'+this.poI_Title+"<\/b><\/span>";n=this.poI_Description=="none"?n+"<\/div>":n+'<br/><br/><font style="font-size:11px">'+this.poI_Description+"<\/font><\/div>";i=new google.maps.InfoWindow({content:n,size:new google.maps.Size(90,90)});google.maps.event.addListener(t,"click",function(){map.setCenter(t.getPosition());$("#dvHstInfContainer").css({top:"-100px",display:"none",position:"relative"});openMapBubble(n)})})}function DeleteMarker(n){for(var t=0;t<poiMarker.length;t++)if(poiMarker[t]==n){mapMark[t].setMap(null);poiMarker.splice(t,1);mapMark.splice(t,1);map.setZoom(13);return}}function onePoi(n){if(poiMarker.indexOf(n)>-1)return DeleteMarker(n),!1;poiMarker.push(n);var t=[];t=$.grep(objPoi,function(t){return t.poiid==n});jQuery.each(t,function(){var t,i,r;locLat=this.poI_Latitude;locLong=this.poI_Longitude;iconImg="https://pictures.tripmasters.com/siteassets/d/MapMarker_Ball__Orange_40.gif";t=new google.maps.Marker({position:new google.maps.LatLng(locLat,locLong),map:map,icon:iconImg});t.id=n;mapMark.push(t);i='<div style="padding:5px" class="Text_11" align="left"><img src="'+this.poI_PictureURL+'" align="left" style="width:50%; height:50%; margin:0px 5px 5px 0px;"  /><span><b class="Text_12_BlueBold">'+this.poI_Title+"<\/b><\/span>";i=this.poI_Description=="none"?i+"<\/div>":i+'<br/><br/><font style="font-size:11px">'+this.poI_Description+"<\/font><\/div>";r=new google.maps.LatLng(locLat,locLong);map.setCenter(r);map.setZoom(15);$("#dvHstInfContainer").css({top:"-100px",display:"none",position:"relative"});google.maps.event.addListener(t,"click",function(){map.setCenter(t.getPosition());$("#dvHstInfContainer").css({top:"-100px",display:"none",position:"relative"})})})}function bubbleHotelInfo(n){var i,t;openModal();typeModal="default";i=pageHotels;i=$.grep(i,function(t){return t.pdlid==n});t="";jQuery.each(i,function(){var r=this.gipH_TNTournetRating.match(isNumber),i,n,u,f,e,o;r===null?r=this.gipH_TNTournetRating:"";i="";n="";switch(!0){case/Stars|Lodge|Cruise/g.test(this.gipH_TNTournetRating):n="Stars_"+this.gipH_TNTournetRating.replace(/\s/g,"_");break;case!/Stars|Lodge|Cruise/g.test(this.gipH_TNTournetRating):n=this.gipH_TNTournetRating.replace(/\s/g,"_").toLowerCase()}u=/Stars/g.test(this.gipH_TNTournetRating)?this.gipH_TNTournetRating:"";i='<div class="hotel-info__stars"><img style="vertical-align:middle" src="https://pictures.tripmasters.com/siteassets/d/'+n+'.gif" align="absmiddle" /><span>'+u+"<\/span><\/div>";t=t+'<div class="info-hotel__wrapper">';this.imG_Url!="none"&&(t=t+'<div class="info-hotel__image"><img src="https://pictures.tripmasters.com'+this.imG_Url.toLowerCase()+'"/><\/div>');t=t+"<div>";t=t+'<div class="info-hotel__description"><h2>'+this.pdL_Title+"<\/h2>";this.gipH_TNSequence>49&&this.gipH_TNSequence<60&&(t=t+'<img class="info-hotel__favorite" src="https://pictures.tripmasters.com/siteassets/d/favorite.gif"/>');t=t+i+"<p>"+this.hotelAddress+"<\/p>";f=this.ghS_FinalScore;e=expediaNoRange(this.ghS_FinalScore);switch(e){case"EX":solNA="Excellent";clsNA="EX";break;case"VG":solNA="Very Good";clsNA="VG";break;case"GD":solNA="Good";clsNA="GD";break;case"FA":solNA="Fair";clsNA="FA";break;case"PO":solNA="Poor";clsNA="PO"}o=this.ghS_ExpediaReviewCount>0?" ("+this.ghS_ExpediaReviewCount+" reviews)":"";t=t+"<div><span><b>"+f+"/5 <\/b><\/span>"+solNA+o+"<\/div>";t=t+"<\/div>";this.hotelDescription!="none"&&(t=t+'<div class="hotel-info__text">'+this.hotelDescription+"<\/div>");t=t+"<\/div>";t=t+"<\/div>"});$(".modal__container").html(t)}function expediaNoRange(n){return n.between(4.5,5)?"EX":n.between(4,4.49)?"VG":n.between(3.5,3.99)?"GD":n.between(3,3.49)?"FA":n.between(0,2.99)?"PO":void 0}function openModalMap(){openModal();typeModal="map";$(".modal__container").html("");$(".hotels__map > div").appendTo(".modal__container")}function openModalFilter(){openModal();typeModal="sort";$(".modal__container").html("");$(".hotels__filter > div").appendTo(".modal__container")}function openModal(){$(".modal__container").html('<div style="padding:15px 15px;text-align:center;"><img src="https://pictures.tripmasters.com/siteassets/d/wait.gif"><\/div>');$("#modal").removeClass("is-hidden");$("body").addClass("modal-open")}function closeModal(){$("#modal").addClass("is-hidden");$("body").removeClass("modal-open");switch(typeModal){case"map":$(".modal__container > div").appendTo(".hotels__map");break;case"sort":$(".modal__container > div").appendTo(".hotels__filter");break;case"default":$(".modal__container").html("")}}function getDistanceFromLatLonInKm(n,t,i,r){var u=deg2rad(i-n),f=deg2rad(r-t),e=Math.sin(u/2)*Math.sin(u/2)+Math.cos(deg2rad(n))*Math.cos(deg2rad(i))*Math.sin(f/2)*Math.sin(f/2),o=2*Math.atan2(Math.sqrt(e),Math.sqrt(1-e));return 6371*o}function deg2rad(n){return n*(Math.PI/180)}function getRandomInt(n,t){return Math.floor(Math.random()*(t-n))+n}function grepRev(n,t){var r=[],u=[],f=[],e=[],o=[],s=[],h,c;if(r=n,h=t.split("|"),c=h.length,c==1)return t=t.replace("_","."),t==4.5?r=$.grep(r,function(n){return n.ghS_FinalScore>=4.5}):"",t==4?r=$.grep(r,function(n){return n.ghS_FinalScore.between(4,4.49)}):"",t==3.5?r=$.grep(r,function(n){return n.ghS_FinalScore.between(3.5,3.99)}):"",t==3?r=$.grep(r,function(n){return n.ghS_FinalScore.between(3,3.49)}):"",t==0?r=$.grep(r,function(n){return n.ghS_FinalScore.between(0,2.99)}):"",r;for(i=0;i<=c-1;i++)switch(h[i].replace("_",".")){case"4.5":u=r;u=$.grep(u,function(n){return n.ghS_FinalScore>=4.5});break;case"4":f=r;f=$.grep(f,function(n){return n.ghS_FinalScore.between(4,4.49)});break;case"3.5":e=r;e=$.grep(e,function(n){return n.ghS_FinalScore.between(3.5,3.99)});break;case"3":o=r;o=$.grep(o,function(n){return n.ghS_FinalScore.between(3,3.49)});break;case"0":s=r;s=$.grep(s,function(n){return n.ghS_FinalScore.between(0,2.99)})}return[].concat.apply([],[u,f,e,o,s])}var poiMarker=[],objHotels=[],objPoi=[],objData,ctyLatLong,NAplc,IDplc,NAcou,IDcou,isNumber=/[0-9]+/g,jsFav=0,distLats,pageHotels=[],cityPoi=[],mapMark;let typeModal="default";$(document).ready(function(){var n={IDplc:plcID,Pageno:1,Ratings:"",HotelName:"",Favorites:"",Review:"",CityZone:"",Sort:parseInt(1)};$.ajax({type:"POST",url:SiteName+"/Api/Hotels/HotelsOnPlace",data:JSON.stringify(n),contentType:"application/json; charset=UTF-8",dataType:"json",success:function(n){pageHotels=n;console.log(n);initpoi()},error:function(n){alert(n.responseText)}})});mapMark=[];Number.prototype.between=function(n,t){return n<t?this>=n&&this<=t:this>=t&&this<=n};