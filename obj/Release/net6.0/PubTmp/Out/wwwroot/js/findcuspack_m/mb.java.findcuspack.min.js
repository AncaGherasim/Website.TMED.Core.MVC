function init(){var n=$("#placeID").val(),t={Id:n};$.ajax({type:"POST",url:SiteName+"/Api/FindItinPacks",contentType:"application/json; charset=utf-8",data:JSON.stringify(t),success:function(n){objPks=n;initpkObj=objPks;objPks!=""&&$.each(objPks,function(){this.pdL_Places!=null&&(pdlPlaceIds=pdlPlaceIds+this.pdL_Places)});pdlPlaceIds=pdlPlaceIds.substr(1,pdlPlaceIds.length-2);getCities(pdlPlaceIds);buildPacks();createPagination()},error:function(n){console.log(n.responseText)}})}function getCities(n){var t={Id:n};$.ajax({type:"POST",url:SiteName+"/Api/All_Packages/GetAllPlaces",contentType:"application/json; charset=utf-8",dataType:"text",data:JSON.stringify(t),success:function(n){ctyObj=JSON.parse(n);$.each(JSON.parse(n),function(n,t){var i=$.grep(countries,function(n){return n.countryName===t.countryName});i.length===0&&countries.push(t)});buildCityList()},error:function(n){console.log(n.responseText)}})}function buildPacks(){$(".dvPkList").html("");var n="",t=page*10,r=prevInt*nxtPg*10,u=objPks.slice(r,t);$(".spNoPks").text(objPks.length);$.each(u,function(){var r,t;for(n=n+"<div class='row pt-2 pb-2 border border-secondary border-top-0 border-right-0 border-left-0'><div class='col-4 pr-0'><img class='img-fluid' src='https://pictures.tripmasters.com"+this.imG_Path_URL.replace(" ","_")+"' /><\/div><div class='col-8 pl-0'><div class='col font14 blueText pr-0'>"+this.pdL_Title+"<\/div><div class='col'>",this.stP_NumOfNights!=""&&(n=this.spD_InternalComments.indexOf("Inflexible package")==-1?n+"<span class='font12 greyText'>"+this.stP_NumOfNights+" to "+(this.stP_NumOfNights+Math.round(this.stP_NumOfNights/2))+" nights<\/span>":n+"<span class='font12 greyText'>"+this.stP_NumOfNights+" nights<\/span>"),this.stP_Save!=9999&&this.stP_Save!=""&&(n=n+"<span class='font12 greyText'> from <b class='orgClr'>"+formatCurrency(this.stP_Save,0)+"*<\/b><\/span>"),n=n+"<\/div><div class='col'><button type='button' class='btn btn-link font12 pl-0' data-target='#dvPkDesc"+this.pdlid+"' data-toggle='collapse' aria-expanded='false'>Show Itinerary Details<\/button><\/div><div class='col'><a href='"+SiteName+"/"+this.stR_PlaceTitle.replace(/\s/g,"_").toLowerCase()+"/"+this.pdL_Title.replace(/\s/g,"_").toLowerCase()+"/package-"+this.pdlid+"' class='btn btn-warning btn-block font14'>View It<\/a><\/div><\/div>",this.spD_Description!=""&&(r=new RegExp(/<[^<>]+>/g),this.spD_Description=this.spD_Description.replace(r,"")),n=n+"<div class='collapse font12' id='dvPkDesc"+this.pdlid+"'><div class='col-12 pt-4'>"+this.spD_Description+"<\/div><div class='col-12'>This sample price includes ALL air taxes & fuel surcharges: "+this.stP_MiniTitle+" for arrival on"+this.stP_StartTravelDate+", departure from "+this.plC_Title+". Choose your own departure city and dates.<\/div><div class='col-12'><span>This "+this.stP_NumOfNights+" night sample itinerary includes:<\/span><ul class='p-0 pl-3'>",t=this.pdL_Content.split(/\n/g),i=0;i<=t.length-1;i++)n=n+"<li>"+t[i]+"<\/li>";n=n+"<\/ul><div class='col-12 border border-secondary border-bottom-0 border-left-0 border-right-0 text-center'><a class='btn btn-link font12' href='"+SiteName+"/"+this.stR_PlaceTitle.replace(/\s/g,"_").toLowerCase()+"/"+this.pdL_Title.replace(/\s/g,"_").toLowerCase()+"/feedback-"+this.pdlid+"'>See out Customer feedbacks ("+this.noOfFeed+")<\/a><\/div>";n=n+"<\/div><\/div><\/div>"});$(".dvPkList").append(n)}function buildCityList(){var n="",t=$("#placeID").val().split(",");$.each(countries,function(i,r){n=n+"<div class='list-group-item list-group-item-action bg-white pl-0 pr-0'><button type='button' class='btn btn-outline-light btn-block text-dark text-left pl-0 pr-0 border-0 btnctylst collapsed' data-target='#dvCityList"+r.countryId+"' data-toggle='collapse'>"+r.countryName+"<\/button><div class='collapse list-group-flush' id='dvCityList"+r.countryId+"'>";$.each(ctyObj,function(i,u){u.countryName==r.countryName&&(n=n+"<div class='list-group-item list-group-item-action bg-white'>",$.each(t,function(t,i){i==u.placeId&&(n=n+"<input type='checkbox' name='radio-city' class='mr-1' id='radiocity"+u.placeId+"' value='"+u.placeId+"' checked />")}),n=n+"<input type='checkbox' name='radio-city' class='mr-1' id='radiocity"+u.placeId+"' value='"+u.placeId+"' /><label for='radiocity"+u.placeId+"'>"+u.placeName+"<\/label><\/div>")});n=n+"<\/div><\/div>"});$(".dvCities").append(n)}function createPagination(){var t=Math.ceil(objPks.length/10),n;for($(".totPag").text("Total: "+t),n="",i=1;i<=t;i++)n=n+'<option value="'+i+'">'+i+"<\/option>";$(".selPage").html(n);$(".Page").removeClass("d-none").removeAttr("style")}function pagination(n){var t=parseInt($(".selPage").val()),i,r;if(n===undefined)prevInt=t-1,page=t,$(".selPage option").each(function(){$(this).val()!=t?$(this).removeAttr("selected"):$(this).val()==t&&$(this).attr("selected","selected")});else if(n.id==="pagePrev"){if(t===0)return;page=t;prevInt=page-1;i=page-1;$(".selPage option").each(function(){$(this).val()==t?$(this).removeAttr("selected"):$(this).val()==i&&$(this).attr("selected","selected")})}else n.id==="pageNext"&&(page=t+1,prevInt=page-1,r=page-2,$(".selPage option").each(function(){$(this).val()==t?$(this).removeAttr("selected"):$(this).val()==page&&$(this).attr("selected","selected")}));buildPacks()}function formatCurrency(n){n=n.toString().replace(/\$|\,/g,"");isNaN(n)&&(n="0");sign=n==(n=Math.abs(n));n=Math.floor(n*100+.50000000001);cents=n%100;n=Math.floor(n/100).toString();cents<10&&(cents="0"+cents);for(var t=0;t<Math.floor((n.length-(1+t))/3);t++)n=n.substring(0,n.length-(4*t+3))+","+n.substring(n.length-(4*t+3));return(sign?"":"-")+"$"+n}function orderBy(n){var i,t;sortList=objPks;switch(!0){case/radiochoice/i.test(n.id):i=n.value;switch(i){case"1":sortList=objPks;t=$("label[for="+n.id+"]").html();$(".typeOrder").text(t);break;case"2":sortList=sortList.sort(function(n,t){return n.stP_NumOfNights>t.stP_NumOfNights?1:n.stP_NumOfNights<t.stP_NumOfNights?-1:0});t=$("label[for="+n.id+"]").html();$(".typeOrder").text(t);break;case"3":sortList=sortList.sort(function(n,t){return n.stP_Save>t.stP_Save?1:n.stP_Save<t.stP_Save?-1:0});t=$("label[for="+n.id+"]").html();$(".typeOrder").text(t);break;case"4":sortList=sortList.sort(function(n,t){return n.stP_Save<t.stP_Save?1:n.stP_Save>t.stP_Save?-1:0});t=$("label[for="+n.id+"]").html();$(".typeOrder").text(t);break;case"5":sortList=sortList.sort(function(n,t){return n.plC_Title<t.plC_Title?1:n.plC_Title>t.plC_Title?-1:0});t=$("label[for="+n.id+"]").html();$(".typeOrder").text(t)}break;case/radioprice/i.test(n.id):switch(n.value){case"0_999":sortList=$.grep(objPks,function(n){return n.stP_Save.between(0,999)});break;case"1000_1999":sortList=$.grep(objPks,function(n){return n.stP_Save.between(1e3,1999)});break;case"2000_2999":sortList=$.grep(objPks,function(n){return n.stP_Save.between(2e3,2999)});break;case"3000_3999":sortList=$.grep(objPks,function(n){return n.stP_Save.between(3e3,3999)});break;case"4000_MAX":sortList=$.grep(objPks,function(n){return n.stP_Save.between(4e3,9999)})}break;case/radionight/i.test(n.id):switch(n.value){case"0_7":sortList=$.grep(objPks,function(n){return n.stP_NumOfNights.between(0,7)});break;case"8_10":sortList=$.grep(objPks,function(n){return n.stP_NumOfNights.between(8,10)});break;case"11_14":sortList=$.grep(objPks,function(n){return n.stP_NumOfNights.between(11,14)});break;case"15_MAX":sortList=$.grep(objPks,function(n){return n.stP_NumOfNights.between(15,99)})}}objPks=sortList;buildPacks();createPagination();$("#dvFilter").modal("hide")}function applyFilter(){var t=[],n;$("input[type='checkbox']").each(function(){this.checked?t.push(this.value):""});n=[];$.each(t,function(t,i){$.each(objPks,function(t,r){this.pdL_Places!=null&&this.pdL_Places.indexOf(i.toString())>=0&&n.push(r)})});objPks=n;buildPacks();createPagination()}function resetFilters(){objPks=initpkObj;buildPacks();createPagination();$("#dvFilter").modal("hide")}var $loader="<div class='loader'><\/div>",page=1,tot,objPks,initpkObj,prevInt=0,nxtPg=1,pdlPlaceIds="",countries=[],ctyObj;$(document).ready(function(){$(".dvPkList").html($loader);plcNA=$("#placeNA").val();init();$(document).on("click",".pageNext, .pagePrev",function(n){n.preventDefault();pagination(this)});$(".selPage").change(function(){pagination(this.val)});$(document).on("click",".btnReset",function(){resetFilters()});$(document).on("click",".btnApply",function(){applyFilter()});$("#orderby .list-group-item").click(function(){var n=$(this).children("input");$(this).children("input").attr("checked","checked");orderBy(n[0])});$(document).on("click","input[type='radio']",function(){orderBy(this)})});Number.prototype.between=function(n,t){return n<t?this>=n&&this<=t:this>=t&&this<=n};